= Utilisation de l'API EXAI

Ce document explique comment accéder et interagir avec les différentes API exposées par les microservices du projet EXAI une fois déployés sur Minikube.

== Accéder aux Services via Minikube

Chaque microservice déployé sur Kubernetes (comme l'API Gateway ou le Service Sélection) est exposé via un "Service" Kubernetes. Minikube fournit un moyen simple d'obtenir une URL accessible depuis votre machine hôte pour chaque service.

Pour obtenir l'URL d'un service spécifique (par exemple, `api-gateway`), utilisez la commande suivante dans votre terminal (assurez-vous que Minikube est démarré et les services déployés dans le namespace `exai`) :

[source,bash]
----
minikube service <nom-du-service> --url -n exai
----

Remplacez `<nom-du-service>` par le nom du service Kubernetes que vous souhaitez atteindre (par exemple, `api-gateway`, `service-selection`).

**Exemple pour obtenir l'URL de l'API Gateway :**

[source,bash]
----
minikube service api-gateway --url -n exai
----

**Exemple pour obtenir l'URL du Service Sélection :**

[source,bash]
----
minikube service service-selection --url -n exai
----

Copiez l'URL retournée par la commande (elle ressemble généralement à `http://127.0.0.1:xxxxx`). C'est l'adresse de base pour interagir avec ce service.

== Documentation API Interactive (OpenAPI / Swagger UI)

Les microservices basés sur FastAPI (comme `api-gateway` et `service-selection`) génèrent automatiquement une documentation API interactive basée sur la spécification OpenAPI.

Pour accéder à cette documentation :

1.  Obtenez l'URL du service souhaité en utilisant la commande `minikube service ... --url` comme décrit ci-dessus.
2.  Ouvrez votre navigateur web.
3.  Collez l'URL obtenue et ajoutez `/docs` à la fin.

**Exemple pour la documentation de l'API Gateway :**

Si `minikube service api-gateway --url -n exai` retourne `http://127.0.0.1:56789`, alors naviguez vers `http://127.0.0.1:56789/docs`.

**Exemple pour la documentation du Service Sélection :**

Si `minikube service service-selection --url -n exai` retourne `http://127.0.0.1:12345`, alors naviguez vers `http://127.0.0.1:12345/docs`.

Vous verrez alors l'interface Swagger UI, qui vous permet de :

*   Voir tous les points de terminaison (endpoints) disponibles.
*   Consulter les détails de chaque endpoint (méthode HTTP, paramètres, corps de requête attendu, réponses possibles).
*   **Essayer directement les endpoints** depuis votre navigateur.

NOTE: Vous pouvez également utiliser `/redoc` à la place de `/docs` pour une vue alternative de la documentation OpenAPI.

== Exemples d'Interaction (avec `curl`)

Bien que la documentation interactive soit le moyen le plus simple d'explorer l'API, voici quelques exemples utilisant `curl` pour interagir avec les endpoints.

_Prérequis : Remplacez `<URL_SERVICE_SELECTION>` par l'URL obtenue avec `minikube service service-selection --url -n exai`._

*   **Lister tous les datasets (via Service Sélection) :**

[source,bash]
----
curl -X GET "<URL_SERVICE_SELECTION>/datasets/"
----

*   **Créer un nouveau dataset (via Service Sélection) :**

[source,bash]
----
curl -X POST "<URL_SERVICE_SELECTION>/datasets/" \
-H "Content-Type: application/json" \
-d '{
  "name": "Mon Nouveau Dataset",
  "description": "Description via curl",
  "file_path": "/chemin/vers/mon/fichier.csv",
  "file_type": "csv"
}'
----

*   **Obtenir les détails d'un dataset spécifique (via Service Sélection, ex: ID 1) :**

[source,bash]
----
curl -X GET "<URL_SERVICE_SELECTION>/datasets/1"
----

NOTE: Pour connaître les endpoints disponibles sur l'API Gateway, consultez sa documentation interactive via `<URL_API_GATEWAY>/docs`. 