= Guide d'int√©gration : Nouvelle √©tape de nettoyage dans le wizard ML
:toc:
:toclevels: 3
:icons: font

== Vue d'ensemble

Ce guide explique comment int√©grer la nouvelle √©tape de nettoyage des donn√©es directement dans le wizard ML Pipeline, conform√©ment aux exigences :

* √âtape d√©di√©e uniquement au nettoyage
* Explications claires pour les non-experts  
* Interface simple avec option "Auto-Fix Magique"
* Possibilit√© de personnalisation manuelle

== Structure propos√©e

=== Organisation des √©tapes

[cols="1,3,3"]
|===
| √âtape | Nom | Responsabilit√©

| 1
| S√©lection du Dataset
| Confirmer le choix du dataset

| 2
| **Nettoyage des donn√©es** ‚≠ê
| Analyser et corriger les probl√®mes de qualit√©

| 3
| Configuration du mod√®le
| Choisir la variable cible et le type de t√¢che

| 4
| Choix de l'algorithme
| S√©lectionner l'algorithme ML

| 5
| Hyperparam√®tres
| Ajuster les param√®tres

| 6
| Entra√Ænement
| Lancer et suivre l'entra√Ænement
|===

== Impl√©mentation de l'√©tape 2

=== 1. Structure HTML

L'√©tape de nettoyage comprend 3 √©tats principaux :

==== √âtat initial : √âducation
[source,html]
----
<!-- Explications p√©dagogiques sur le nettoyage -->
<div class="pre-analysis-state">
  <!-- Introduction : pourquoi nettoyer -->
  <div class="education-intro">
    <h3>üéØ Pourquoi nettoyer les donn√©es ?</h3>
    <p>80% du travail en IA = pr√©parer les donn√©es</p>
  </div>
  
  <!-- Probl√®mes courants illustr√©s -->
  <div class="problem-cards">
    <!-- Cartes visuelles pour chaque type de probl√®me -->
  </div>
  
  <!-- Solutions expliqu√©es simplement -->
  <div class="solution-strategies">
    <!-- 3 strat√©gies : Suppression, Imputation, Interpolation -->
  </div>
  
  <!-- Call to action -->
  <button (click)="analyzeDataQuality()">
    Lancer l'analyse automatique
  </button>
</div>
----

==== √âtat analyse : Feedback visuel
[source,html]
----
<div class="analyzing-state">
  <mat-spinner></mat-spinner>
  <h3>üîç Analyse en cours...</h3>
  <!-- √âtapes de progression -->
</div>
----

==== √âtat r√©sultats : Actions et personnalisation
[source,html]
----
<div class="analysis-results-state">
  <!-- Score de qualit√© global -->
  <div class="quality-overview">
    <div class="score-card">92/100</div>
    <div class="stats-cards"><!-- Stats --></div>
  </div>
  
  <!-- Bouton Auto-Fix principal -->
  <button class="auto-fix-button" (click)="applyAutoFix()">
    ‚ú® Appliquer toutes les recommandations
  </button>
  
  <!-- D√©tails par colonne avec personnalisation -->
  <mat-tab-group>
    <mat-tab label="Probl√®mes d√©tect√©s">
      <!-- Colonnes avec issues -->
    </mat-tab>
    <mat-tab label="Colonnes propres">
      <!-- Colonnes OK -->
    </mat-tab>
  </mat-tab-group>
</div>
----

=== 2. Logique TypeScript

==== Analyse de qualit√© avec cache
[source,typescript]
----
analyzeDataQuality() {
  this.isAnalyzingData = true;
  
  this.mlPipelineService.analyzeDataQuality({
    dataset_id: this.datasetId,
    force_refresh: false  // Utilise le cache
  }).subscribe(
    analysis => {
      this.dataQualityAnalysis = analysis;
      this.processAnalysisResults(analysis);
      this.isAnalyzingData = false;
    }
  );
}

processAnalysisResults(analysis: any) {
  // Transformer les r√©sultats pour l'affichage
  this.columnsAnalysis = [];
  
  Object.entries(analysis.missing_data_analysis.columns_with_missing)
    .forEach(([columnName, info]: [string, any]) => {
      this.columnsAnalysis.push({
        name: columnName,
        type: this.getColumnType(info),
        missingPercentage: info.missing_percentage,
        missingCount: info.missing_count,
        totalCount: this.getTotalRows(),
        recommendedStrategy: info.recommended_strategy.strategy,
        recommendationReason: info.recommended_strategy.reason,
        selectedStrategy: info.recommended_strategy.strategy // Par d√©faut
      });
    });
}
----

==== Application automatique des recommandations
[source,typescript]
----
applyAutoFixRecommendations() {
  // Animation de traitement
  this.isProcessing = true;
  
  // Appliquer toutes les strat√©gies recommand√©es
  this.columnsAnalysis.forEach(column => {
    column.selectedStrategy = column.recommendedStrategy;
  });
  
  // Sauvegarder la configuration
  this.dataCleaningForm.patchValue({
    columnStrategies: this.buildStrategiesConfig(),
    autoFixApplied: true,
    analysisCompleted: true
  });
  
  // Feedback visuel
  setTimeout(() => {
    this.isProcessing = false;
    this.showSuccessMessage = true;
  }, 1000);
}
----

=== 3. Styles SCSS

Le design suit une approche moderne et accessible :

[source,scss]
----
// Palette de couleurs pour la s√©v√©rit√©
.critical { background: #ffebee; color: #c62828; }
.high { background: #ffe0b2; color: #e65100; }
.medium { background: #fff9c4; color: #f57f17; }
.low { background: #dcedc8; color: #33691e; }

// Cartes de probl√®mes avec hover effect
.problem-card {
  transition: transform 0.2s;
  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }
}

// Bouton Auto-Fix pro√©minent
.auto-fix-button {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 1rem 2rem;
  font-size: 1.1rem;
  box-shadow: 0 4px 12px rgba(102,126,234,0.4);
}
----

== Flux utilisateur optimal

[plantuml]
----
@startuml
start
:Utilisateur arrive √† l'√©tape 2;
:Affichage des explications p√©dagogiques;
:Clic sur "Lancer l'analyse";
:Animation d'analyse (5-10s);
:Affichage des r√©sultats avec score;
if (Auto-Fix?) then (oui)
  :Application automatique;
  :Confirmation visuelle;
else (non)
  :Personnalisation manuelle;
  :S√©lection par colonne;
endif
:Validation et passage √©tape 3;
stop
@enduml
----

== Points cl√©s de l'UX

=== P√©dagogie int√©gr√©e
* Explications visuelles des probl√®mes
* Exemples concrets (√Çge: 999 ans)
* Impact clairement expliqu√©

=== Simplicit√© d'usage
* Un seul bouton principal : Auto-Fix
* Personnalisation cach√©e par d√©faut
* Progression claire et guid√©e

=== Feedback constant
* Animations pendant l'analyse
* Score de qualit√© visuel
* Confirmation des actions

== Migration depuis l'ancienne version

Pour migrer depuis l'ancienne version o√π le nettoyage √©tait m√©lang√© avec la configuration :

1. **S√©parer les FormGroups**
   - `dataCleaningForm` : uniquement nettoyage
   - `dataQualityForm` : variable cible + config mod√®le

2. **D√©placer les contr√¥les**
   - Variable cible ‚Üí √âtape 3
   - Type de t√¢che ‚Üí √âtape 3
   - Scaling/Encoding ‚Üí Appliqu√©s apr√®s nettoyage

3. **Simplifier l'interface**
   - Retirer les options expertes par d√©faut
   - Ajouter un mode "avanc√©" optionnel

== Exemple d'utilisation

[source,typescript]
----
// Composant wizard principal
export class MlPipelineWizardComponent {
  
  // √âtat de l'√©tape de nettoyage
  dataQualityAnalysis: any = null;
  columnsAnalysis: ColumnAnalysis[] = [];
  isAnalyzingData = false;
  
  // M√©thode principale
  analyzeDataQuality() {
    this.isAnalyzingData = true;
    
    this.mlPipelineService.analyzeDataQuality({
      dataset_id: this.datasetId,
      sample_size: 10000
    }).subscribe(
      result => {
        this.dataQualityAnalysis = result;
        this.generateColumnsAnalysis(result);
        this.isAnalyzingData = false;
      }
    );
  }
  
  // Validation de l'√©tape
  isDataCleaningComplete(): boolean {
    return this.dataCleaningForm.get('analysisCompleted')?.value === true;
  }
}
----

== R√©sultat attendu

L'impl√©mentation de cette nouvelle √©tape permet :

* ‚úÖ **Clart√©** : Une √©tape = une fonction
* ‚úÖ **Accessibilit√©** : Explications pour non-experts
* ‚úÖ **Performance** : Cache des analyses
* ‚úÖ **Flexibilit√©** : Auto ou manuel
* ‚úÖ **Modernit√©** : Design actuel et animations

Cette approche rend le nettoyage des donn√©es accessible √† tous, tout en gardant la puissance n√©cessaire pour les utilisateurs avanc√©s.