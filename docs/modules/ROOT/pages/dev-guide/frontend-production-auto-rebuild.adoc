= Auto-Rebuild Frontend Production - Guide Technique
:navtitle: Auto-Rebuild Frontend
:description: Configuration automatique du frontend Angular en mode production

== Vue d'ensemble

Le script `deploy-to-azure.sh` int√®gre d√©sormais une fonctionnalit√© automatique de reconstruction du frontend Angular en mode production pour garantir que les bonnes URLs d'API sont utilis√©es.

== Fonctionnalit√©s automatiques

=== 1. Configuration automatique de l'environnement

Le script modifie automatiquement `frontend/src/environments/environment.prod.ts` avec les URLs correctes :

[source,typescript]
----
export const environment = {
  production: true,
  apiUrl: 'https://api.ibisx.fr',
  productionDomain: 'ibisx.fr'
};
----

=== 2. Rebuild forc√© avec --no-cache

En mode production, le script :

* Supprime les images Docker frontend existantes
* Force la reconstruction avec `--no-cache`
* Utilise `--build-arg ANGULAR_ENV=production`
* Push automatiquement vers Azure Container Registry

=== 3. Red√©ploiement automatique

Apr√®s la reconstruction :

* Mise √† jour de l'image du deployment Kubernetes
* Rollout restart automatique
* Attente de la compl√©tion du d√©ploiement

== D√©clenchement automatique

La fonctionnalit√© se d√©clenche automatiquement quand :

* `DEPLOYMENT_MODE=manual-production`
* ou `ANGULAR_ENV=production`

[source,bash]
----
# Le script d√©tecte automatiquement le mode production
./scripts/deploy-to-azure.sh
----

== Logs de d√©bogage

Le script fournit des logs d√©taill√©s :

[source,bash]
----
[INFO] üéØ Mode production d√©tect√© - V√©rification et correction automatique du frontend...
[INFO] üöÄ Reconstruction automatique du frontend en mode production...
[INFO] üìù Mise √† jour FORC√âE des URLs frontend pour le domaine de production...
[INFO] üéØ CONFIGURATION PRODUCTION FORC√âE:
[INFO]    API URL: https://api.ibisx.fr
[INFO]    Frontend Domain: ibisx.fr
[INFO]    Production Mode: TRUE
[INFO] üßπ Suppression des images frontend existantes...
[INFO] üèóÔ∏è Construction frontend avec ANGULAR_ENV=production...
[SUCCESS] ‚úÖ Frontend FORC√â en mode production:
[SUCCESS]    ‚úÖ production: true
[SUCCESS]    ‚úÖ API URL: https://api.ibisx.fr
[SUCCESS]    ‚úÖ Domaine: ibisx.fr
----

== Avantages

* **Automatique** : Plus besoin de modifier manuellement les fichiers de configuration
* **Fiable** : Rebuild forc√© avec --no-cache garantit la prise en compte des changements
* **Imm√©diat** : Red√©ploiement automatique apr√®s reconstruction
* **V√©rification** : Validation automatique des URLs configur√©es

== D√©pannage

=== Probl√®me : URLs de d√©veloppement utilis√©es en production

**Solution** : Le script corrige automatiquement ce probl√®me en for√ßant la reconstruction.

=== Probl√®me : Image Docker non mise √† jour

**Solution** : Le script supprime les images existantes et force le rebuild avec `--no-cache`.

=== V√©rification manuelle

Pour v√©rifier que le frontend utilise les bonnes URLs :

[source,bash]
----
# Voir les logs du pod frontend
kubectl logs -f deployment/frontend -n ibis-x

# V√©rifier la configuration dans le navigateur
# Developer Tools > Network > Voir les appels vers api.ibisx.fr
----

== Fichiers modifi√©s automatiquement

[cols="1,3"]
|===
| Fichier | Modification

| `frontend/src/environments/environment.prod.ts`
| URLs mises √† jour automatiquement

| Images Docker
| Reconstruction forc√©e avec bonnes variables d'environnement

| Deployment Kubernetes
| Image mise √† jour et rollout restart
|=== 