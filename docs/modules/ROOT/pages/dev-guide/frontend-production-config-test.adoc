= Test Configuration Frontend Production
:navtitle: Test Frontend Production

== Vue d'ensemble

Ce guide vous aide √† **v√©rifier** que votre frontend Angular est correctement configur√© en **mode production** avec les bonnes URLs API apr√®s d√©ploiement.

== Probl√®me R√©solu

**Avant :** Le script `deploy-to-azure.sh` ne configurait pas correctement le frontend ‚Üí URLs dev utilis√©es en production

**Maintenant :** Configuration automatique du frontend ‚Üí URLs production correctes !

== Tests de V√©rification

=== üß™ Test 1 : V√©rifier la Configuration Frontend

[source,bash]
----
# V√©rifier le fichier environment.prod.ts apr√®s d√©ploiement
cat frontend/src/environments/environment.prod.ts

# Vous devriez voir :
# apiUrl: 'https://api.ibisx.fr'
# productionDomain: 'ibisx.fr'
----

=== üß™ Test 2 : V√©rifier l'Image Docker Frontend

[source,bash]
----
# Se connecter √† votre ACR
az acr login --name [VOTRE_ACR_NAME]

# V√©rifier les tags d'images
az acr repository show-tags --name [VOTRE_ACR_NAME] --repository frontend

# Tester l'image localement (optionnel)
docker run -p 8080:80 [VOTRE_ACR_NAME].azurecr.io/frontend:latest
----

=== üß™ Test 3 : V√©rifier les URLs en Production

[source,bash]
----
# Tester l'API via le frontend d√©ploy√©
curl -I https://api.ibisx.fr/health

# Tester le frontend
curl -I https://ibisx.fr

# V√©rifier les certificats SSL
curl -s -o /dev/null -w "SSL: %{ssl_verify_result}\n" https://ibisx.fr
----

=== üß™ Test 4 : V√©rifier les Logs du Frontend

[source,bash]
----
# Voir les logs du pod frontend
kubectl logs -f deployment/frontend -n ibis-x

# Rechercher des erreurs de connexion API
kubectl logs deployment/frontend -n ibis-x | grep -i "api\|error\|connection"
----

== Test Complet du Workflow

=== üìã Proc√©dure de Test

[source,bash]
----
# 1. V√©rifier les fichiers AVANT d√©ploiement
echo "=== AVANT D√âPLOIEMENT ==="
cat frontend/src/environments/environment.prod.ts

# 2. Lancer le d√©ploiement
bash scripts/deploy-to-azure.sh

# 3. V√©rifier les fichiers APR√àS d√©ploiement
echo "=== APR√àS D√âPLOIEMENT ==="
cat frontend/src/environments/environment.prod.ts

# 4. Tester l'application
echo "=== TEST APPLICATION ==="
curl -I https://ibisx.fr
curl -I https://api.ibisx.fr/health
----

=== ‚úÖ R√©sultats Attendus

.Configuration Frontend Correcte
[source,javascript]
----
export const environment = {
  production: true,
  apiUrl: 'https://api.ibisx.fr',
  productionDomain: 'ibisx.fr'
};
----

.R√©ponses Curl Attendues
----
# Frontend
HTTP/1.1 200 OK
Content-Type: text/html

# API
HTTP/1.1 200 OK
Content-Type: application/json
----

== D√©pannage

=== üîç Probl√®me : Frontend utilise encore localhost

**Cause :** Le script n'a pas configur√© correctement l'environnement

**Solution :**
[source,bash]
----
# V√©rifier les logs du d√©ploiement
grep -i "frontend\|angular" /tmp/deploy-logs.txt

# Forcer la reconfiguration
rm frontend/src/environments/environment.prod.ts.backup-*
bash scripts/deploy-to-azure.sh
----

=== üîç Probl√®me : API non accessible depuis frontend

**Cause :** CORS mal configur√© ou certificats SSL

**Solution :**
[source,bash]
----
# V√©rifier l'ingress CORS
kubectl get ingress ibis-x-ingress -n ibis-x -o yaml | grep cors

# V√©rifier les certificats
kubectl get certificates -n ibis-x
kubectl describe certificate ibisx-tls -n ibis-x
----

=== üîç Probl√®me : Images Docker non mises √† jour

**Cause :** Cache Docker ou push rat√©

**Solution :**
[source,bash]
----
# V√©rifier les images dans ACR
az acr repository list --name [VOTRE_ACR_NAME]

# Forcer rebuild sans cache
docker build --no-cache -t [ACR_NAME].azurecr.io/frontend:latest frontend/
docker push [ACR_NAME].azurecr.io/frontend:latest

# Red√©marrer les pods
kubectl rollout restart deployment/frontend -n ibis-x
----

== Automatisation GitHub Actions

Le workflow GitHub Actions utilise le **m√™me script**, donc ces tests s'appliquent aussi au d√©ploiement automatique.

### Diff√©rences GitHub Actions vs Script Manuel

.Comparaison
|===
|Aspect |Script Manuel |GitHub Actions

|Configuration Frontend
|‚úÖ Automatique
|‚úÖ Automatique

|Secrets
|‚ö†Ô∏è Placeholders
|‚úÖ Vrais secrets

|Images Docker
|‚úÖ Build local
|‚úÖ Build dans runner

|IP Statique
|‚úÖ Terraform
|‚úÖ Terraform
|===

TIP: Les deux m√©thodes produisent le **m√™me r√©sultat** pour la configuration frontend !

== Validation Compl√®te

### ‚úÖ Checklist Finale

- [ ] `environment.prod.ts` contient `https://api.ibisx.fr`
- [ ] Frontend accessible sur `https://ibisx.fr`
- [ ] API accessible sur `https://api.ibisx.fr`
- [ ] Certificats SSL valides
- [ ] Pas d'erreurs CORS dans les logs
- [ ] Donn√©es charg√©es correctement

### üéâ Succ√®s !

Si tous les tests passent, votre frontend est **correctement configur√©** en production !

Plus besoin de `git push origin production` juste pour corriger la configuration frontend. 