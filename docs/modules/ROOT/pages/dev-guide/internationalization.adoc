= Guide d'Internationalisation (i18n)
:toc:
:toclevels: 3

Ce guide explique comment l'internationalisation est impl√©ment√©e dans l'application ExAI et comment ajouter de nouvelles traductions.

== Vue d'ensemble

L'application utilise `@ngx-translate/core` pour fournir un support multilingue complet. Les langues actuellement support√©es sont :

* **Fran√ßais** (fr) - Langue par d√©faut
* **Anglais** (en) - Langue secondaire
* **Espagnol** (es) - Placeholders en attente de traduction native
* **Allemand** (de) - Placeholders en attente de traduction native

== Architecture i18n

=== Structure des fichiers

[source]
----
frontend/src/assets/i18n/
‚îú‚îÄ‚îÄ en.json       # Traductions anglaises
‚îú‚îÄ‚îÄ fr.json       # Traductions fran√ßaises  
‚îú‚îÄ‚îÄ es.json       # Traductions espagnoles (placeholders)
‚îî‚îÄ‚îÄ de.json       # Traductions allemandes (placeholders)
----

=== Services cl√©s

==== LanguageService
G√®re le changement de langue et la persistence des pr√©f√©rences utilisateur.

[source,typescript]
----
// Changement de langue
this.languageService.changeLanguage('en');

// Obtenir la langue actuelle
const currentLang = this.languageService.getCurrentLanguage();
----

==== FormErrorService
Service centralis√© pour les erreurs de formulaire traduites.

[source,typescript]
----
// Obtenir un message d'erreur traduit
const errorMsg = this.formErrorService.getErrorMessage(control, 'Email');

// V√©rifier si afficher l'erreur
const shouldShow = this.formErrorService.shouldShowError(control);
----

== Structure des cl√©s de traduction

=== Organisation hi√©rarchique

Les cl√©s sont organis√©es par section fonctionnelle :

[source,json]
----
{
  "AUTH": {
    "LOGIN": { ... },
    "REGISTER": { ... }
  },
  "DASHBOARD": {
    "TITLE": "...",
    "METRICS": { ... },
    "ACTIVITY": { ... }
  },
  "PROJECTS": {
    "FORM": { ... },
    "LIST": { ... },
    "DETAIL": { ... }
  },
  "FORMS": {
    "VALIDATION": { ... }
  }
}
----

=== Conventions de nommage

* **SECTIONS** : Majuscules (AUTH, DASHBOARD, PROJECTS)
* **SOUS-SECTIONS** : Majuscules (LOGIN, REGISTER, FORM)
* **CL√âS FINALES** : Majuscules s√©par√©es par underscore (TITLE, FIRST_NAME, EMAIL_REQUIRED)

== Impl√©mentation dans les composants

=== Composants standard

==== 1. Imports requis

[source,typescript]
----
import { TranslateModule, TranslateService } from '@ngx-translate/core';

@Component({
  // ...
  imports: [/* autres modules */, TranslateModule],
})
----

==== 2. Injection du service

[source,typescript]
----
export class MyComponent {
  private translate = inject(TranslateService);
}
----

==== 3. Utilisation dans le template

[source,html]
----
<!-- Traduction simple -->
<h1>{{ 'DASHBOARD.TITLE' | translate }}</h1>

<!-- Traduction avec param√®tres -->
<p>{{ 'DASHBOARD.WELCOME' | translate: {name: userName} }}</p>

<!-- Traduction d'attributs -->
<input [placeholder]="'FORMS.EMAIL_PLACEHOLDER' | translate">
----

==== 4. Traductions programmatiques

[source,typescript]
----
// Traduction imm√©diate
const message = this.translate.instant('SUCCESS_MESSAGE');

// Traduction avec param√®tres
const welcomeMsg = this.translate.instant('WELCOME', { name: 'John' });

// Traduction asynchrone (Observable)
this.translate.get('ASYNC_MESSAGE').subscribe(translation => {
  console.log(translation);
});
----

=== Donn√©es dynamiques

Pour les donn√©es qui changent avec la langue, utilisez des getters :

[source,typescript]
----
export class DashboardComponent {
  private baseMetrics = [
    { titleKey: 'DASHBOARD.METRICS.DATASETS', value: 5 },
    { titleKey: 'DASHBOARD.METRICS.PIPELINES', value: 3 }
  ];

  get dashboardMetrics() {
    return this.baseMetrics.map(metric => ({
      title: this.translate.instant(metric.titleKey),
      value: metric.value
    }));
  }
}
----

== Gestion des formulaires

=== Validation avec traductions

[source,typescript]
----
// Dans le composant
constructor() {
  this.formErrorService = inject(FormErrorService);
}

// Obtenir le message d'erreur
getFieldError(fieldName: string): string | null {
  const control = this.form.get(fieldName);
  return this.formErrorService.getErrorMessage(control, fieldName);
}
----

[source,html]
----
<!-- Dans le template -->
<mat-form-field>
  <mat-label>{{ 'FORMS.EMAIL' | translate }}</mat-label>
  <input matInput formControlName="email">
  <mat-error *ngIf="formErrorService.shouldShowError(form.get('email'))">
    {{ getFieldError('email') }}
  </mat-error>
</mat-form-field>
----

=== Messages d'erreur standardis√©s

Le `FormErrorService` g√®re automatiquement :

* `required` - Champ obligatoire
* `email` - Format email invalide  
* `minlength` - Longueur minimale
* `maxlength` - Longueur maximale
* `pattern` - Format invalide
* `mismatch` - Confirmation mot de passe

== Ajouter une nouvelle langue

=== 1. Cr√©er le fichier de traduction

Cr√©ez `frontend/src/assets/i18n/[code].json` avec la structure compl√®te :

[source,json]
----
{
  "AUTH": {
    "LOGIN": {
      "TITLE": "Connexion",
      "EMAIL": "Email",
      // ... toutes les cl√©s
    }
    // ... toutes les sections
  }
}
----

=== 2. Mettre √† jour LanguageService

[source,typescript]
----
// Dans language.service.ts
languages = [
  { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑' },
  { code: 'en', name: 'English', flag: 'üá∫üá∏' },
  { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
  { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
  { code: 'it', name: 'Italiano', flag: 'üáÆüáπ' }  // Nouvelle langue
];
----

=== 3. Configurer le module de traduction

Le fichier sera automatiquement charg√© via `TranslateHttpLoader`.

== Bonnes pratiques

=== 1. Coh√©rence des cl√©s

* Utilisez des cl√©s descriptives et hi√©rarchiques
* √âvitez les cl√©s trop longues ou trop courtes
* Groupez par fonctionnalit√© logique

=== 2. Gestion des param√®tres

[source,json]
----
{
  "WELCOME_MESSAGE": "Bienvenue {{name}} !",
  "ITEMS_COUNT": "{{count}} √©l√©ment{{count > 1 ? 's' : ''}}"
}
----

=== 3. Pluralisation

Pour les textes avec pluriel, utilisez des cl√©s distinctes :

[source,json]
----
{
  "DATASET_COUNT_ZERO": "Aucun dataset",
  "DATASET_COUNT_ONE": "1 dataset", 
  "DATASET_COUNT_OTHER": "{{count}} datasets"
}
----

=== 4. Valeurs par d√©faut

Toujours fournir une valeur par d√©faut pour √©viter les cl√©s manquantes :

[source,typescript]
----
const title = this.translate.instant('MISSING_KEY') || 'Titre par d√©faut';
----

== Tests

=== Test des traductions

[source,typescript]
----
describe('Component i18n', () => {
  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [TranslateModule.forRoot({
        loader: {
          provide: TranslateLoader,
          useClass: TranslateFakeLoader
        }
      })]
    });
  });

  it('should translate text correctly', () => {
    const translateService = TestBed.inject(TranslateService);
    translateService.setTranslation('en', { 'HELLO': 'Hello' });
    translateService.use('en');
    
    expect(translateService.instant('HELLO')).toBe('Hello');
  });
});
----

== Performance

=== Optimisations

* Les traductions sont charg√©es une seule fois au d√©marrage
* Utilisez `translate.instant()` pour les traductions synchrones
* Les getters recalculent automatiquement lors du changement de langue
* √âvitez les translations dans les boucles *ngFor*

=== Lazy loading

Les fichiers de traduction sont charg√©s √† la demande via HTTP. Seule la langue active est charg√©e en m√©moire.

== D√©pannage

=== Probl√®mes courants

==== Cl√© manquante
```
ERROR: Missing translation for key 'MY_KEY'
```
**Solution** : V√©rifiez que la cl√© existe dans tous les fichiers de traduction.

==== Traduction non mise √† jour
**Solution** : Utilisez des getters au lieu de propri√©t√©s statiques pour les donn√©es dynamiques.

==== Param√®tres non interpol√©s
```json
{"MESSAGE": "Hello {{name}}"}
```
**Solution** : V√©rifiez que les param√®tres sont pass√©s correctement :
```typescript
this.translate.instant('MESSAGE', { name: 'John' })
```

== Migration d'un texte existant

=== √âtapes pour traduire un composant

1. **Identifier les textes** √† traduire
2. **Cr√©er les cl√©s** dans les fichiers JSON
3. **Ajouter TranslateModule** aux imports du composant
4. **Injecter TranslateService** 
5. **Remplacer les textes** par les pipes de traduction
6. **Tester** le changement de langue

=== Exemple de migration

**Avant :**
[source,html]
----
<h1>Tableau de bord</h1>
<p>Bienvenue sur votre dashboard</p>
----

**Apr√®s :**
[source,html]
----
<h1>{{ 'DASHBOARD.TITLE' | translate }}</h1>
<p>{{ 'DASHBOARD.WELCOME' | translate }}</p>
----

**Fichier de traduction :**
[source,json]
----
{
  "DASHBOARD": {
    "TITLE": "Tableau de bord",
    "WELCOME": "Bienvenue sur votre dashboard"
  }
}
----

== Ressources

* Documentation ngx-translate : https://github.com/ngx-translate/core
* Guide Angular i18n : https://angular.io/guide/i18n
* FormErrorService : `frontend/src/app/services/form-error.service.ts`
* LanguageService : `frontend/src/app/services/language.service.ts` 