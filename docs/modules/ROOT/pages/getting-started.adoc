= üöÄ Installation et D√©marrage Rapide d'EXAI

Bienvenue dans le guide de d√©marrage du projet EXAI !

Ce document vous explique comment installer les outils n√©cessaires et d√©ployer l'application EXAI sur votre ordinateur personnel en utilisant Minikube. Minikube nous permet de simuler un environnement Kubernetes (l'outil utilis√© pour orchestrer nos microservices) localement pour le d√©veloppement et les tests.

Suivez attentivement ces √©tapes pour avoir une instance fonctionnelle d'EXAI.

== √âtape 1 : Pr√©parer votre Environnement de D√©veloppement

Avant de pouvoir d√©ployer EXAI, vous devez installer quelques outils essentiels sur votre machine.

=== Pr√©requis Logiciels

Assurez-vous d'avoir les logiciels suivants install√©s :

1.  **Docker Desktop** : C'est le moteur qui g√®re nos conteneurs logiciels. Minikube l'utilise en arri√®re-plan.
    *   *Installation :* Suivez les instructions sur le site officiel de https://www.docker.com/products/docker-desktop/[Docker Desktop^].
    *   *V√©rification :* Ouvrez un terminal et tapez `docker --version`. Vous devriez voir une version s'afficher.

2.  **Minikube** : L'outil pour ex√©cuter un cluster Kubernetes √† n≈ìud unique sur votre machine.
    *   *Installation :* Voir les commandes ci-dessous pour votre syst√®me d'exploitation ou consultez la https://minikube.sigs.k8s.io/docs/start/[documentation officielle de Minikube^].
    *   *V√©rification :* Apr√®s installation, tapez `minikube version` dans votre terminal.

3.  **kubectl** : L'outil en ligne de commande pour interagir avec votre cluster Kubernetes (local ou distant).
    *   *Installation :* Voir les commandes ci-dessous ou consultez la https://kubernetes.io/docs/tasks/tools/install-kubectl/[documentation officielle de kubectl^].
    *   *V√©rification :* Apr√®s installation, tapez `kubectl version --client` dans votre terminal.

4.  **Terminal Bash (Recommand√©)** : Pour ex√©cuter les commandes de ce guide.
    *   *Windows :* Utilisez https://gitforwindows.org/[Git Bash^] (inclus avec Git pour Windows) ou WSL (Windows Subsystem for Linux).
    *   *macOS/Linux :* Utilisez le terminal int√©gr√©.

5.  **(Optionnel mais recommand√©) Gestionnaire de paquets :**
    *   *Windows :* https://chocolatey.org/install[Chocolatey^]
    *   *macOS :* https://brew.sh/[Homebrew^]

=== Commandes d'Installation (Minikube & kubectl)

Choisissez les commandes correspondant √† votre syst√®me :

*   **Windows (avec Chocolatey)** :
    Ouvrez PowerShell en tant qu'administrateur :
[source,powershell,subs="attributes+"]
----
choco install minikube
choco install kubernetes-cli
----

*   **macOS (avec Homebrew)** :
    Ouvrez votre Terminal :
[source,bash,subs="attributes+"]
----
brew install minikube
brew install kubectl
----

*   **Linux (Debian/Ubuntu)** :
    Ouvrez votre Terminal :
[source,bash,subs="attributes+"]
----
# Installer Minikube
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube
rm minikube-linux-amd64

# Installer kubectl
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
rm kubectl
----

Apr√®s l'installation, v√©rifiez que les outils fonctionnent avec les commandes `minikube version` et `kubectl version --client`.

== √âtape 2 : Cloner le D√©p√¥t du Projet

Si ce n'est pas d√©j√† fait, r√©cup√©rez le code source du projet EXAI depuis son d√©p√¥t Git.

[source,bash]
----
git clone <URL_DU_DEPOT_GIT_EXAI>
cd <NOM_DU_DOSSIER_PROJET_EXAI>
----
IMPORTANT: Ex√©cutez toutes les commandes suivantes depuis la racine de ce dossier projet clon√©.

== √âtape 3 : D√©ployer l'Application EXAI sur Minikube

Maintenant que les outils sont pr√™ts, nous allons d√©marrer notre cluster local et y d√©ployer les composants d'EXAI.

=== 3.1 D√©marrer Minikube

Minikube va cr√©er une machine virtuelle (ou utiliser un conteneur Docker) pour h√©berger votre cluster Kubernetes.

. Ouvrez votre terminal (√† la racine du projet EXAI).
. Lancez la commande suivante :
  [source,bash]
  ----
  minikube start
  # Astuce: Si vous avez plusieurs Go de RAM, vous pouvez allouer plus de ressources:
  # minikube start --memory 4096 --cpus 2
  ----
  Le premier d√©marrage peut prendre quelques minutes car Minikube t√©l√©charge les images n√©cessaires.

. Une fois termin√©, v√©rifiez que le cluster est bien d√©marr√© :
  [source,bash]
  ----
  minikube status
  ----
  Vous devriez voir des informations indiquant que `minikube`, `apiserver`, et `kubeconfig` sont `Running` ou `Configured`.

=== 3.2 Cr√©er un Espace de Noms (Namespace)

Pour garder notre application organis√©e et isol√©e des autres composants syst√®me de Kubernetes, nous cr√©ons un "namespace" appel√© `exai`.

[source,bash]
----
kubectl create namespace exai
----
NOTE: Si vous voyez une erreur indiquant que le namespace existe d√©j√† (`Error from server (AlreadyExists)`), ce n'est pas grave, vous pouvez continuer.

=== 3.3 D√©ployer la Base de Donn√©es (PostgreSQL)

EXAI a besoin d'une base de donn√©es PostgreSQL pour fonctionner. Nous la d√©ployons en premier.

. Appliquez les fichiers de configuration Kubernetes pour PostgreSQL :
  [source,bash]
  ----
  kubectl apply -f k8s/postgres/ -n exai
  ----
  Cela cr√©e un `Deployment` (qui g√®re le Pod PostgreSQL) et un `Service` (qui permet aux autres composants de communiquer avec la base de donn√©es).

. V√©rifiez que le pod PostgreSQL d√©marre correctement :
  [source,bash]
  ----
  kubectl get pods -n exai -l app=postgresql
  ----
  Attendez que le statut du pod passe √† `Running`. Cela peut prendre une minute ou deux. Vous pouvez relancer la commande pour suivre l'√©volution. Si le statut reste bloqu√© sur `Pending` ou `ContainerCreating` pendant longtemps, consultez la section D√©pannage.

=== 3.4 Initialiser la Base de Donn√©es

Une fois le pod PostgreSQL en cours d'ex√©cution (`Running`), nous devons ex√©cuter un script SQL pour cr√©er les tables n√©cessaires.

. Identifiez le nom exact du pod PostgreSQL. La commande suivante devrait l'afficher directement :
  [source,bash]
  ----
  POD_NAME=$(kubectl get pods -n exai -l app=postgresql -o jsonpath='{.items[0].metadata.name}')
  echo "Nom du pod PostgreSQL trouv√© : $POD_NAME"
  ----
  Si cela ne fonctionne pas, utilisez `kubectl get pods -n exai | grep postgresql` et copiez le nom manuellement. **Notez bien ce nom pour les commandes suivantes.**

. Copiez le script d'initialisation dans le pod :
  [source,bash]
  ----
  # Remplacez <NOM_DU_POD_POSTGRES> par le nom que vous avez not√©
  kubectl cp k8s/postgres/init-db.sql <NOM_DU_POD_POSTGRES>:/tmp/init-db.sql -n exai
  ----

. Ex√©cutez le script SQL √† l'int√©rieur du pod :
  [source,bash]
  ----
  # Remplacez <NOM_DU_POD_POSTGRES> par le nom que vous avez not√©
  kubectl exec -n exai <NOM_DU_POD_POSTGRES> -- psql -U exai_user -d exai_db -f /tmp/init-db.sql
  ----
  Vous devriez voir des messages indiquant la cr√©ation des tables (`CREATE TABLE`).

=== 3.5 D√©ployer les Microservices EXAI

Nous allons maintenant d√©ployer les diff√©rents services qui composent l'application EXAI.

IMPORTANT: Pour que Minikube puisse utiliser les images Docker que nous allons construire localement, vous devez connecter votre terminal √† l'environnement Docker de Minikube. Ex√©cutez la commande appropri√©e *une fois* pour votre session terminal :

*   **Linux/macOS (Bash/Zsh)** :
    [source,bash]
    ----
    eval $(minikube -p minikube docker-env)
    ----
*   **Windows (PowerShell)** :
    [source,powershell]
    ----
    minikube -p minikube docker-env | Invoke-Expression
    ----
*   **Windows (Git Bash)** :
    [source,bash]
    ----
    eval $(minikube -p minikube docker-env)
    ----

Maintenant, d√©ployez chaque service. Pour l'instant, nous allons d√©ployer les services principaux :

**(√Ä adapter avec les noms r√©els des services et dossiers quand ils existeront)**

1.  **API Gateway (`api-gateway`)**
    [source,bash]
    ----
    # 1. Aller dans le dossier du service
    cd api-gateway
    # 2. Construire l'image Docker locale
    docker build -t exai-api-gateway:latest .
    # 3. Appliquer les manifestes Kubernetes
    kubectl apply -f k8s/deployment.yaml -n exai
    kubectl apply -f k8s/service.yaml -n exai
    # 4. Revenir √† la racine
    cd ..
    ----

2.  **Service S√©lection (`service-selection`)**
    [source,bash]
    ----
    # 1. Aller dans le dossier du service
    cd service-selection
    # 2. Construire l'image Docker locale
    docker build -t exai-service-selection:latest .
    # 3. Appliquer les manifestes Kubernetes
    kubectl apply -f k8s/deployment.yaml -n exai
    kubectl apply -f k8s/service.yaml -n exai
    # 4. Revenir √† la racine
    cd ..
    ----

3.  **Service ML (`service-ml`)**
    [source,bash]
    ----
    # (Commandes similaires : cd service-ml, docker build ..., kubectl apply ..., cd ..)
    # Remplacer par les commandes r√©elles quand le service existera
    echo "D√©ploiement de service-ml √† faire..."
    ----

4.  **Service XAI (`service-xai`)**
    [source,bash]
    ----
    # (Commandes similaires : cd service-xai, docker build ..., kubectl apply ..., cd ..)
    # Remplacer par les commandes r√©elles quand le service existera
    echo "D√©ploiement de service-xai √† faire..."
    ----

5.  **Frontend (`frontend`)**
    [source,bash]
    ----
    # (Commandes similaires : cd frontend, docker build ..., kubectl apply ..., cd ..)
    # Remplacer par les commandes r√©elles quand le service existera
    echo "D√©ploiement de frontend √† faire..."
    ----

=== 3.6 V√©rifier le D√©ploiement

Apr√®s avoir lanc√© le d√©ploiement de tous les services, v√©rifiez que leurs pods d√©marrent correctement.

[source,bash]
----
kubectl get pods -n exai
----
Attendez que tous les pods (PostgreSQL, api-gateway, service-selection, etc.) affichent le statut `Running`. Cela peut prendre quelques minutes car les images sont charg√©es et les conteneurs d√©marr√©s.

Vous pouvez aussi v√©rifier les services Kubernetes :
[source,bash]
----
kubectl get services -n exai
----

== √âtape 4 : Acc√©der √† l'Application EXAI

Une fois que tous les pods sont `Running`, vous pouvez acc√©der √† l'application. L'acc√®s principal se fait g√©n√©ralement via le Frontend.

. Obtenez l'URL d'acc√®s au service frontend :
  [source,bash]
  ----
  minikube service frontend --url -n exai
  ----
  Cette commande ouvrira peut-√™tre directement l'URL dans votre navigateur, ou affichera l'URL (ex: `http://127.0.0.1:xxxxx`) dans le terminal.

. Ouvrez l'URL retourn√©e dans votre navigateur web. Vous devriez voir l'interface utilisateur d'EXAI.

Pour explorer les API directement (par exemple, pour le d√©veloppement ou des tests avanc√©s) :

. Obtenez l'URL de l'API Gateway :
  [source,bash]
  ----
  minikube service api-gateway --url -n exai
  ----

. Acc√©dez √† la documentation interactive (Swagger UI) en ajoutant `/docs` √† l'URL obtenue : `http://127.0.0.1:yyyyy/docs`.

Voir la page xref:dev-guide/api-reference.adoc[R√©f√©rence API] pour plus de d√©tails sur l'utilisation des API.

F√©licitations ! Vous avez d√©ploy√© EXAI localement avec Minikube.

== (Optionnel) D√©pannage

*   **Minikube ne d√©marre pas :** V√©rifiez que Docker Desktop est lanc√©. Essayez `minikube delete` puis `minikube start`. V√©rifiez les logs avec `minikube logs`. Assurez-vous que la virtualisation est activ√©e dans le BIOS/UEFI de votre machine si vous n'utilisez pas le driver Docker.
*   **Pod bloqu√© en `Pending` :** Manque de ressources (CPU/M√©moire) ? Essayez d'allouer plus de ressources √† Minikube (`minikube stop`, `minikube config set memory 4096`, `minikube start`). Probl√®me de r√©seau ? V√©rifiez la sortie de `kubectl describe pod <nom-du-pod> -n exai`.
*   **Pod bloqu√© en `ImagePullBackOff` ou `ErrImagePull`:** L'image Docker n'a pas pu √™tre trouv√©e. Avez-vous bien ex√©cut√© `eval $(minikube -p minikube docker-env)` (ou √©quivalent) *avant* de lancer `docker build` ? Le nom et le tag de l'image dans `k8s/deployment.yaml` correspondent-ils exactement √† ceux utilis√©s lors du `docker build` ? Avez-vous mis `imagePullPolicy: IfNotPresent` ou `Never` dans le `deployment.yaml` pour les images locales ?
*   **`minikube service ... --url` ne fonctionne pas :** Assurez-vous que le service Kubernetes existe (`kubectl get services -n exai`). V√©rifiez l'√©tat du pod associ√©.

== Arr√™ter l'environnement

Pour arr√™ter l'application et lib√©rer les ressources :

[source,bash]
----
minikube stop
----

Pour supprimer compl√®tement le cluster Minikube (attention, supprime toutes les donn√©es) :
[source,bash]
----
minikube delete
---- 