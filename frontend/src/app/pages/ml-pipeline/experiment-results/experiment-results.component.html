<div class="results-container" *ngIf="results; else loadingTemplate" [@fadeIn]>

  <!-- Section M√©triques -->
  <section class="metrics-section" [@slideUp]>
    <h2 class="section-title">üìà Performance & M√©triques - {{getAlgorithmDisplay()}}</h2>

    <!-- Cards m√©triques principales -->
    <div class="metrics-grid-modern" *ngIf="getMetricsArray().length > 0">
      <div class="metric-card-modern" *ngFor="let metric of getMetricsArray().slice(0, 4); let i = index">
        <div class="metric-content">
          <div class="metric-header">
            <div class="metric-icon-wrapper" [ngClass]="getMetricColor(metric.value)">
              <mat-icon>{{getMetricIcon(metric.key)}}</mat-icon>
            </div>
            <h4 class="metric-title">{{getMetricLabel(metric.key)}}</h4>
          </div>
          <div class="metric-value-large" [ngClass]="getMetricColor(metric.value)">
            {{formatMetricValue(metric.key, metric.value)}}
          </div>
          <div class="trend-indicator" [ngClass]="getTrendClass(metric.value)">
            <mat-icon class="trend-icon">{{getTrendIcon(metric.value)}}</mat-icon>
            <span class="trend-text">{{getTrendText(metric.value)}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si pas de m√©triques -->
    <div class="no-metrics" *ngIf="getMetricsArray().length === 0">
      <mat-icon>info</mat-icon>
      <p>Aucune m√©trique num√©rique disponible pour cet algorithme.</p>
    </div>
  </section>

  <!-- Section Visualisations Principales -->
  <section class="algorithm-section" [@slideUp]>
    <h2 class="section-title">üé® Visualisations Interactives</h2>

    <div class="visualizations-grid">
      <!-- Arbre de D√©cision -->
      <div class="chart-card" *ngIf="getAlgorithm() === 'decision_tree'">
        <div class="chart-content chart-extra-tall">
          <app-echarts-container
            [visualizationType]="VisualizationType.DECISION_TREE"
            [data]="getTreeStructureData('decision_tree')"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-echarts-container>
        </div>
      </div>

      <!-- Random Forest -->
      <div class="chart-card" *ngIf="getAlgorithm() === 'random_forest'">
        <div class="chart-content chart-extra-tall">
          <app-echarts-container
            [visualizationType]="VisualizationType.DECISION_TREE"
            [data]="getTreeStructureData('random_forest')"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-echarts-container>
        </div>
      </div>

      <!-- Graphique R√©gression -->
      <div class="chart-card" *ngIf="getTaskType() === 'regression' || getAlgorithm() === 'linear_regression'">
        <div class="chart-content">
          <app-echarts-container
            [visualizationType]="VisualizationType.REGRESSION_PLOT"
            [data]="getRegressionPlotData()"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-echarts-container>
        </div>
      </div>

      <!-- Distribution des Pr√©dictions -->
      <div class="chart-card">
        <div class="chart-content">
          <app-echarts-container
            [visualizationType]="VisualizationType.PREDICTIONS_DISTRIBUTION"
            [data]="getPredictionsDistributionData()"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-echarts-container>
        </div>
      </div>

      <!-- Feature Importance -->
      <div class="chart-card" *ngIf="hasFeatureImportance()">
        <div class="chart-content chart-tall">
          <app-echarts-container
            [visualizationType]="VisualizationType.FEATURE_IMPORTANCE"
            [data]="results.feature_importance"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-echarts-container>
        </div>
      </div>

      <!-- M√©triques Performance -->
      <div class="chart-card" *ngIf="getMetricsArray().length > 0">
        <div class="chart-content chart-medium">
          <app-echarts-container
            [visualizationType]="VisualizationType.METRICS"
            [data]="results.metrics"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-echarts-container>
        </div>
      </div>
    </div>
  </section>

  <!-- Section D√©tails -->
  <section class="details-section" [@slideUp]>
    <h2 class="section-title">üìä Informations D√©taill√©es</h2>
    <div class="details-cards">

      <!-- Card Configuration -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>settings</mat-icon>
            Configuration
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">Algorithme :</span>
            <span class="detail-value">{{getAlgorithmDisplay()}}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Type de t√¢che :</span>
            <span class="detail-value">{{getTaskType() === 'classification' ? 'Classification' : 'R√©gression'}}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status :</span>
            <mat-chip [color]="getStatusColor(getStatusDisplay())" selected>
              {{getStatusDisplay()}}
            </mat-chip>
          </div>
          <div class="detail-row">
            <span class="detail-label">Meilleure m√©trique :</span>
            <span class="detail-value">{{getBestMetric()}}</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Card Mod√®le -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>memory</mat-icon>
            Mod√®le
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">ID Exp√©rience :</span>
            <span class="detail-value mono">{{experimentId}}</span>
          </div>
          <div class="detail-row" *ngIf="results.model_uri">
            <span class="detail-label">Stockage :</span>
            <span class="detail-value">Disponible</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Visualisations :</span>
            <span class="detail-value">
              <mat-icon *ngIf="hasFeatureImportance()">check_circle</mat-icon>
              <mat-icon *ngIf="hasConfusionMatrix()">check_circle</mat-icon>
              <mat-icon *ngIf="hasRocCurve()">check_circle</mat-icon>
              {{(hasFeatureImportance() ? 1 : 0) + (hasConfusionMatrix() ? 1 : 0) + (hasRocCurve() ? 1 : 0)}} disponible(s)
            </span>
          </div>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-raised-button color="primary" (click)="downloadModel()" [disabled]="!results.model_uri">
            <mat-icon>download</mat-icon>
            T√©l√©charger
          </button>
        </mat-card-actions>
      </mat-card>

      <!-- Card Actions -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>rocket_launch</mat-icon>
            Actions
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>G√©rer cette exp√©rience et cr√©er de nouveaux entra√Ænements.</p>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-stroked-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
            Retour
          </button>
          <button mat-raised-button color="accent" (click)="runNewExperiment()">
            <mat-icon>add</mat-icon>
            Nouvel Entra√Ænement
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </section>
</div>

<!-- Template de chargement -->
<ng-template #loadingTemplate>
  <div class="loading-container">
    <div class="loading-content">
      <div class="loading-spinner">
        <mat-icon class="spin">autorenew</mat-icon>
      </div>
      <h3>Chargement des r√©sultats...</h3>
      <p>R√©cup√©ration des donn√©es de l'exp√©rience <strong>{{experimentId}}</strong></p>
    </div>
  </div>
</ng-template>
