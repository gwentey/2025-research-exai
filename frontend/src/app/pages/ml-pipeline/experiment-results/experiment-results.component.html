<div class="modern-results-page" *ngIf="!isLoading" [@fadeIn]>
  <!-- Header Style Linear/Stripe -->
  <div class="results-hero">
    <div class="hero-background">
      <div class="gradient-overlay"></div>
    </div>
    <div class="hero-content">
      <button class="back-btn" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>

      <div class="hero-main">
        <div class="hero-icon">
          <mat-icon>analytics</mat-icon>
        </div>
        <h1 class="hero-title">Résultats d'entraînement</h1>
        <p class="hero-subtitle">Analyse complète de votre modèle {{ experiment ? (experiment.algorithm | titlecase) : 'ML' }}</p>

        <div class="hero-meta" *ngIf="experiment">
          <div class="meta-badge success">
            <mat-icon>check_circle</mat-icon>
            <span>Entraînement terminé</span>
          </div>
          <div class="meta-info">
            <span class="meta-item">
              <mat-icon>schedule</mat-icon>
              {{ experiment.created_at | date:'short' }}
            </span>
            <span class="meta-item" *ngIf="experiment.updated_at">
              <mat-icon>timer</mat-icon>
              {{ formatDuration(experiment.created_at, experiment.updated_at) }}
            </span>
          </div>
        </div>
      </div>

      <div class="hero-actions">
        <button class="action-btn secondary" (click)="downloadModel()" [disabled]="!results?.model_uri">
          <mat-icon>download</mat-icon>
          <span>Télécharger le modèle</span>
        </button>
        <button class="action-btn primary" (click)="runNewExperiment()">
          <mat-icon>refresh</mat-icon>
          <span>Nouvel entraînement</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Métriques principales style SaaS -->
  <div class="metrics-dashboard" [@slideUp] *ngIf="results?.metrics">
    <div class="dashboard-container">
      <div class="section-header">
        <h2>Métriques de performance</h2>
        <p>Analyse détaillée des performances de votre modèle</p>
      </div>

      <div class="metrics-grid-modern">
        <div class="metric-card-modern"
             *ngFor="let metric of getMetricsArray()"
             [class]="getMetricColor(metric.value)"
             [@slideUp]>
          <div class="metric-header">
            <div class="metric-icon-wrapper">
              <mat-icon>{{ getMetricIcon(metric.key) }}</mat-icon>
            </div>
            <div class="metric-info">
              <h3 class="metric-title">{{ getMetricLabel(metric.key) }}</h3>
              <div class="metric-value-large">{{ formatMetricValue(metric.key, metric.value) }}</div>
            </div>
          </div>

          <!-- Chart.js canvas pour chaque métrique -->
          <div class="metric-chart-container">
            <canvas [id]="'metric-chart-' + metric.key"
                    class="metric-chart"
                    width="100"
                    height="60"></canvas>
          </div>

          <div class="metric-trend">
            <span class="trend-indicator" [class]="getTrendClass(metric.value)">
              <mat-icon>{{ getTrendIcon(metric.value) }}</mat-icon>
              {{ getTrendText(metric.value) }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- Visualisations hybrides modernes -->
  <div class="visualizations-dashboard" [@slideUp] *ngIf="results">
    <div class="dashboard-container">
      <div class="section-header">
        <h2>Visualisations du modèle</h2>
        <p>Analyse visuelle intelligente avec rendu hybride backend/frontend</p>
      </div>

      <!-- Grille des visualisations hybrides -->
      <div class="viz-grid-hybrid" [ngSwitch]="experiment ? experiment.algorithm : ''">

        <!-- Decision Tree - Visualisation hybride -->
        <div *ngSwitchCase="'decision_tree'" class="algorithm-specific-viz">
          <app-visualization-container
            [visualizationType]="VisualizationType.DECISION_TREE"
            [backendImageUrl]="getVisualizationUrl('decision_tree')"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-visualization-container>
        </div>

        <!-- Random Forest - Feature Importance hybride -->
        <div *ngSwitchCase="'random_forest'" class="algorithm-specific-viz">
          <app-visualization-container
            [visualizationType]="VisualizationType.FEATURE_IMPORTANCE"
            [backendImageUrl]="getVisualizationUrl('feature_importance')"
            [data]="results.feature_importance"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-visualization-container>
        </div>

        <!-- Visualisations communes hybrides - ADAPTÉES AU TYPE DE TÂCHE -->
        <div class="common-visualizations-hybrid">

          <!-- Visualisations pour CLASSIFICATION seulement -->
          <ng-container *ngIf="getTaskType() === 'classification'">
            <!-- Matrice de confusion hybride -->
            <app-visualization-container
              [visualizationType]="VisualizationType.CONFUSION_MATRIX"
              [backendImageUrl]="getVisualizationUrl('confusion_matrix')"
              [algorithm]="getAlgorithm()"
              [taskType]="getTaskType()"
              [experimentId]="experimentId">
            </app-visualization-container>

            <!-- Courbe ROC hybride -->
            <app-visualization-container
              [visualizationType]="VisualizationType.ROC_CURVE"
              [backendImageUrl]="getVisualizationUrl('roc_curve')"
              [data]="results.roc_curve"
              [algorithm]="getAlgorithm()"
              [taskType]="getTaskType()"
              [experimentId]="experimentId">
            </app-visualization-container>
          </ng-container>

          <!-- Visualisations pour RÉGRESSION seulement -->
          <ng-container *ngIf="getTaskType() === 'regression'">
            <!-- Graphique de régression hybride -->
            <app-visualization-container
              [visualizationType]="VisualizationType.REGRESSION_PLOT"
              [backendImageUrl]="getVisualizationUrl('regression_plot')"
              [algorithm]="getAlgorithm()"
              [taskType]="getTaskType()"
              [experimentId]="experimentId">
            </app-visualization-container>

            <!-- Distribution des résidus (régression) -->
            <app-visualization-container
              [visualizationType]="VisualizationType.PREDICTIONS_DISTRIBUTION"
              [backendImageUrl]="getVisualizationUrl('residuals_distribution')"
              [algorithm]="getAlgorithm()"
              [taskType]="getTaskType()"
              [experimentId]="experimentId">
            </app-visualization-container>
          </ng-container>

          <!-- Visualisations COMMUNES à tous les types -->
          <!-- Métriques de performance -->
          <app-visualization-container
            [visualizationType]="VisualizationType.METRICS"
            [data]="results?.metrics"
            [algorithm]="getAlgorithm()"
            [taskType]="getTaskType()"
            [experimentId]="experimentId">
          </app-visualization-container>

        </div>
      </div>
    </div>
  </div>

  <!-- Détails de l'expérience style moderne -->
  <div class="experiment-details-modern" [@slideUp] *ngIf="experiment">
    <div class="dashboard-container">
      <div class="section-header">
        <h2>Détails de l'expérience</h2>
        <p>Configuration et paramètres utilisés</p>
      </div>

      <div class="details-cards">
        <div class="detail-card">
          <div class="detail-header">
            <mat-icon>settings</mat-icon>
            <h3>Configuration</h3>
          </div>
          <div class="detail-content">
            <div class="detail-item">
              <span class="label">ID Expérience:</span>
              <code class="value">{{ experimentId }}</code>
            </div>
            <div class="detail-item">
              <span class="label">Algorithme:</span>
              <span class="value">{{ experiment ? (experiment.algorithm | titlecase) : 'Non spécifié' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Statut:</span>
              <mat-chip [color]="getStatusColor(experiment ? experiment.status : 'unknown')" selected>
                {{ experiment ? (experiment.status | titlecase) : 'Inconnu' }}
              </mat-chip>
            </div>
          </div>
        </div>

        <div class="detail-card" *ngIf="results">
          <div class="detail-header">
            <mat-icon>tune</mat-icon>
            <h3>Informations du modèle</h3>
          </div>
          <div class="detail-content">
            <div class="detail-item">
              <span class="label">Modèle entraîné:</span>
              <span class="value">{{ experiment ? (experiment.algorithm | titlecase) : 'Non spécifié' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Nombre de métriques:</span>
              <span class="value">{{ getMetricsArray().length }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Meilleure métrique:</span>
              <span class="value">{{ getBestMetric() }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="isLoading">
  <div class="loading-content">
    <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
    <h2>Chargement des résultats...</h2>
    <p>Récupération des métriques et génération des graphiques...</p>
  </div>
</div>

<!-- Error State -->
<div class="error-state" *ngIf="!isLoading && !experiment && !results">
  <div class="error-content">
    <mat-icon>error_outline</mat-icon>
    <h2>Erreur de chargement</h2>
    <p>Impossible de charger les résultats de l'expérience.</p>
    <button class="action-btn primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      <span>Retour au wizard</span>
    </button>
  </div>
</div>
