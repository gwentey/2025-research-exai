<!-- LAYOUT PRINCIPAL MODERNE - STYLE SAAS PREMIUM -->
<div class="modern-wizard-container">
  <!-- Loading State Moderne -->
  <div *ngIf="isLoading" class="modern-loading-overlay">
    <div class="loading-card">
      <div class="loading-icon">
        <mat-icon class="animate-spin">autorenew</mat-icon>
      </div>
      <h3 class="loading-title">Initialisation de votre assistant ML</h3>
      <p class="loading-subtitle">Préparation de l'environnement...</p>
      <div class="loading-progress">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Layout Principal Moderne -->
  <div class="modern-wizard-layout" *ngIf="!isLoading">
    <!-- Sidebar Navigation (Style Notion) -->
    <aside class="wizard-sidebar">
      <!-- Logo -->
      <div class="wizard-logo">
        <div class="logo-icon">
          <mat-icon>auto_awesome</mat-icon>
        </div>
        <div class="logo-text">ML Pipeline</div>
      </div>
          
      <!-- Navigation Steps -->
      <nav class="wizard-nav">
        <div class="nav-section">
          <div class="nav-steps">
            <a class="nav-step" [class.active]="getCurrentStepNumber() === 1" [class.completed]="getCurrentStepNumber() > 1">
              <div class="step-indicator">
                <span class="step-number">1</span>
              </div>
              <div class="step-content">
                <div class="step-title">Dataset</div>
              </div>
            </a>
            
            <a class="nav-step" [class.active]="getCurrentStepNumber() === 2" [class.completed]="getCurrentStepNumber() > 2">
              <div class="step-indicator">
                <span class="step-number">2</span>
              </div>
              <div class="step-content">
                <div class="step-title">Configuration</div>
              </div>
            </a>
            
            <a class="nav-step" [class.active]="getCurrentStepNumber() === 3" [class.completed]="getCurrentStepNumber() > 3">
              <div class="step-indicator">
                <span class="step-number">3</span>
              </div>
              <div class="step-content">
                <div class="step-title">Algorithme</div>
              </div>
            </a>
            
            <a class="nav-step" [class.active]="getCurrentStepNumber() === 4" [class.completed]="getCurrentStepNumber() > 4">
              <div class="step-indicator">
                <span class="step-number">4</span>
              </div>
              <div class="step-content">
                <div class="step-title">Paramètres</div>
              </div>
            </a>
            
            <a class="nav-step" [class.active]="getCurrentStepNumber() === 5" [class.completed]="experimentResults">
              <div class="step-indicator">
                <span class="step-number">5</span>
              </div>
              <div class="step-content">
                <div class="step-title">Entraînement</div>
              </div>
            </a>
          </div>
        </div>
      </nav>

      <!-- Progress Overview -->
      <div class="wizard-progress-overview">
        <div class="progress-title">Progression</div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
        </div>
        <div class="progress-text">{{ getCurrentStepNumber() }} / 5 étapes complétées</div>
      </div>
    </aside>

    <!-- Contenu Principal Moderne -->
    <main class="modern-wizard-main">
      <!-- Header Flottant Moderne -->
      <header class="modern-floating-header">
        <div class="header-container">
          <div class="header-left">
            <div class="step-indicator">
              <mat-icon class="step-icon animate-pulse">auto_awesome</mat-icon>
              <div class="step-info">
                <h1 class="step-title">{{ getStepTitle() }}</h1>
                <p class="step-subtitle">{{ getStepSubtitle() }}</p>
              </div>
            </div>
          </div>
          
          <div class="header-right">
            <div class="progress-indicator">
              <span class="progress-text">Étape {{ getCurrentStepNumber() }} sur 5</span>
              <div class="progress-circle">
                <svg class="progress-ring" width="32" height="32">
                  <circle cx="16" cy="16" r="14" fill="none" stroke="#e5e7eb" stroke-width="2"/>
                  <circle cx="16" cy="16" r="14" fill="none" stroke="#6366f1" stroke-width="2" 
                          [style.stroke-dasharray]="88" 
                          [style.stroke-dashoffset]="88 - (88 * getProgressPercentage() / 100)"
                          class="progress-circle-active"/>
                </svg>
              </div>
            </div>
            
            <button class="modern-back-button" (click)="goBack()">
              <mat-icon>arrow_back</mat-icon>
              <span>Retour</span>
            </button>
          </div>
        </div>
      </header>

      <!-- Zone de Contenu Moderne -->
      <div class="modern-content-area">
        <!-- Stepper caché pour la logique -->
        <mat-stepper #stepper linear class="hidden-stepper">
          <!-- ÉTAPE 1: Dataset Overview -->
            <mat-step [stepControl]="datasetForm">
              <form [formGroup]="datasetForm">
              <div class="step-container animate-fade-in-up">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>dataset</mat-icon>
                    </div>
                  <h2 class="step-title">Aperçu du Dataset</h2>
                  <p class="step-description">Vérifiez les informations de votre dataset avant de continuer</p>
                  </div>
                  
                <div class="step-body">
                  <div *ngIf="dataset" class="dataset-card modern-card">
                    <div class="dataset-icon">
                        <mat-icon>dataset</mat-icon>
                      </div>
                    <div class="dataset-content">
                      <h3 class="dataset-name">{{ dataset.dataset_name }}</h3>
                        <p class="dataset-description">{{ dataset.objective || 'Aucune description disponible' }}</p>
                        
                        <div class="dataset-stats">
                          <div class="stat" *ngIf="dataset.instances_number">
                            <mat-icon>table_chart</mat-icon>
                            <span>{{ dataset.instances_number | number }} lignes</span>
                          </div>
                          <div class="stat" *ngIf="dataset.features_number">
                            <mat-icon>view_column</mat-icon>
                            <span>{{ dataset.features_number }} colonnes</span>
                          </div>
                          <div class="stat">
                            <mat-icon>verified</mat-icon>
                            <span>Qualité: {{ dataset.overall_score || 85 }}%</span>
                          </div>
                        </div>
                      
                      <div class="dataset-tags" *ngIf="dataset.domain">
                        <span class="tag" *ngFor="let domain of dataset.domain">{{ domain }}</span>
                        </div>
                      </div>
                    </div>
                    
                  <div class="form-group">
                    <label class="form-label">
                      <input type="checkbox" formControlName="confirmed">
                      Je confirme vouloir utiliser ce dataset pour mon expérience ML
                    </label>
                  </div>
                  </div>
                </div>
              </form>
            </mat-step>
            
          <!-- ÉTAPE 2: Configuration -->
            <mat-step [stepControl]="dataQualityForm">
              <form [formGroup]="dataQualityForm">
              <div class="step-container animate-fade-in-up">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>tune</mat-icon>
                    </div>
                  <h2 class="step-title">Configuration des Données</h2>
                  <p class="step-description">Définissez comment traiter vos données</p>
                  </div>
                  
                <div class="step-body">
                  <div class="form-group">
                    <label class="form-label">Colonne cible à prédire</label>
                    <p class="form-description">Sélectionnez la variable que vous souhaitez prédire</p>
                    <select class="form-input form-select" formControlName="targetColumn">
                      <option value="">Choisir une colonne...</option>
                      <option *ngFor="let col of getDatasetColumns()" [value]="col.column_name">
                        {{ col.column_name }} ({{ col.data_type_interpreted || col.data_type_original }})
                      </option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Type de tâche</label>
                    <select class="form-input form-select" formControlName="taskType">
                      <option value="classification">Classification (catégories)</option>
                      <option value="regression">Régression (valeurs numériques)</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Gestion des valeurs manquantes</label>
                    <select class="form-input form-select" formControlName="missingValueStrategy">
                      <option value="drop">Supprimer les lignes incomplètes</option>
                      <option value="mean">Remplacer par la moyenne</option>
                      <option value="median">Remplacer par la médiane</option>
                      <option value="forward_fill">Report de la valeur précédente</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Taille du jeu de test: {{ dataQualityForm.get('testSize')?.value }}%</label>
                    <input type="range" class="form-input" formControlName="testSize" min="10" max="50" step="5">
                    <p class="form-description">Pourcentage de données réservées pour tester le modèle</p>
                    </div>
                    
                  <div class="form-group">
                    <label class="form-label">
                      <input type="checkbox" formControlName="featureScaling">
                        Normalisation des variables numériques
                    </label>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Encodage des variables catégorielles</label>
                    <div class="flex gap-md">
                      <label class="form-label">
                        <input type="radio" formControlName="categoricalEncoding" value="onehot">
                        One-Hot Encoding
                      </label>
                      <label class="form-label">
                        <input type="radio" formControlName="categoricalEncoding" value="label">
                        Label Encoding
                      </label>
                    </div>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
            
          <!-- ÉTAPE 3: Algorithme -->
            <mat-step [stepControl]="algorithmForm">
              <form [formGroup]="algorithmForm">
              <div class="step-container animate-fade-in-up">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>smart_toy</mat-icon>
                    </div>
                  <h2 class="step-title">Sélection de l'Algorithme</h2>
                  <p class="step-description">Choisissez l'algorithme de machine learning adapté à votre problème</p>
                  </div>
                  
                <div class="step-body">
                  <div class="algorithm-grid stagger-children">
                      <div *ngFor="let algo of algorithms" 
                         class="algorithm-card"
                           [class.selected]="algorithmForm.get('algorithm')?.value === algo.name"
                         (click)="selectAlgorithm(algo.name)">
                      
                      <div class="algorithm-content">
                        <div class="algorithm-header">
                          <div class="algorithm-icon">
                            <mat-icon>{{ getAlgorithmIcon(algo.name) }}</mat-icon>
                          </div>
                          <h3 class="algorithm-name">{{ algo.display_name }}</h3>
                        </div>
                        
                        <p class="algorithm-description">{{ algo.description }}</p>
                        
                        <div class="algorithm-features">
                          <span class="feature" *ngIf="algo.supports_classification">Classification</span>
                          <span class="feature" *ngIf="algo.supports_regression">Régression</span>
                          <span class="feature" *ngIf="algo.name === 'random_forest'">Recommandé</span>
                        </div>
                      </div>
                      
                      <div class="selection-indicator">
                        <mat-icon>check</mat-icon>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
            
          <!-- ÉTAPE 4: Hyperparamètres -->
            <mat-step [stepControl]="hyperparametersForm">
              <form [formGroup]="hyperparametersForm">
              <div class="step-container animate-fade-in-up">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>settings</mat-icon>
                    </div>
                  <h2 class="step-title">Paramètres Avancés</h2>
                  <p class="step-description">Affinez les paramètres de votre algorithme</p>
                  </div>
                  
                <div class="step-body">
                  <div *ngIf="selectedAlgorithm" class="modern-card">
                    <div class="flex items-center gap-md mb-0">
                      <div class="algorithm-icon">
                        <mat-icon>{{ getAlgorithmIcon(selectedAlgorithm.name) }}</mat-icon>
                      </div>
                      <h3>{{ selectedAlgorithm.display_name }}</h3>
                    </div>
                    </div>
                    
                  <div *ngFor="let param of objectKeys(selectedAlgorithm?.hyperparameters || {})" class="form-group">
                    <ng-container [ngSwitch]="selectedAlgorithm!.hyperparameters[param].type">
                        <!-- Number Parameter -->
                      <div *ngSwitchCase="'number'">
                        <label class="form-label">{{ param | titlecase }}</label>
                        <p class="form-description">{{ selectedAlgorithm!.hyperparameters[param].description }}</p>
                        <input class="form-input" type="number" [formControlName]="param"
                               [min]="selectedAlgorithm!.hyperparameters[param].min ?? null"
                               [max]="selectedAlgorithm!.hyperparameters[param].max ?? null">
                      </div>
                        
                        <!-- Select Parameter -->
                      <div *ngSwitchCase="'select'">
                        <label class="form-label">{{ param | titlecase }}</label>
                        <p class="form-description">{{ selectedAlgorithm!.hyperparameters[param].description }}</p>
                        <select class="form-input form-select" [formControlName]="param">
                          <option *ngFor="let option of selectedAlgorithm!.hyperparameters[param].options" [value]="option">
                              {{ option }}
                          </option>
                        </select>
                      </div>
                        
                        <!-- Boolean Parameter -->
                      <div *ngSwitchCase="'boolean'">
                        <label class="form-label">
                          <input type="checkbox" [formControlName]="param">
                            {{ param | titlecase }}
                        </label>
                        <p class="form-description">{{ selectedAlgorithm!.hyperparameters[param].description }}</p>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
            
          <!-- ÉTAPE 5: Entraînement -->
            <mat-step [stepControl]="summaryForm">
              <form [formGroup]="summaryForm">
              <div class="step-container animate-fade-in-up">
                <div class="step-header">
                    <div class="step-icon">
                    <mat-icon>{{ experimentResults ? 'check_circle' : (isTraining ? 'autorenew' : 'rocket_launch') }}</mat-icon>
                    </div>
                  <h2 class="step-title">
                    {{ experimentResults ? 'Entraînement Terminé !' : (isTraining ? 'Entraînement en cours...' : 'Lancer l\'Entraînement') }}
                  </h2>
                  <p class="step-description">
                    {{ experimentResults ? 'Votre modèle a été entraîné avec succès' : (isTraining ? 'Veuillez patienter pendant l\'entraînement' : 'Vérifiez votre configuration et lancez l\'entraînement') }}
                  </p>
                  </div>
                  
                <div class="step-body">
                  <!-- Résumé de la configuration -->
                  <div *ngIf="!isTraining && !experimentResults" class="modern-card">
                    <h3>Résumé de votre configuration</h3>
                    <div class="flex gap-lg">
                      <div>
                        <strong>Dataset:</strong> {{ dataset?.dataset_name }}
                      </div>
                      <div>
                        <strong>Algorithme:</strong> {{ selectedAlgorithm?.display_name }}
                      </div>
                      <div>
                        <strong>Variable cible:</strong> {{ dataQualityForm.get('targetColumn')?.value }}
                      </div>
                      <div>
                        <strong>Type de tâche:</strong> {{ dataQualityForm.get('taskType')?.value }}
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">
                        <input type="checkbox" formControlName="confirmed">
                      Je confirme vouloir lancer l'entraînement avec ces paramètres
                      </label>
                    </div>
                  </div>
                  
                  <!-- Progression de l'entraînement -->
                  <div *ngIf="isTraining" class="modern-card text-center">
                    <div class="loading-spinner"></div>
                    <h3>Entraînement en cours...</h3>
                    <div class="progress-bar">
                      <div class="progress-fill" [style.width.%]="trainingProgress"></div>
                      </div>
                    <p>{{ trainingProgress }}% complété</p>
                  </div>
                  
                  <!-- Résultats -->
                  <div *ngIf="experimentResults" class="modern-card">
                    <h3>Résultats de l'entraînement</h3>
                    <div class="flex gap-lg">
                      <div *ngFor="let metric of objectKeys(experimentResults.metrics)" class="text-center">
                        <div class="text-lg font-bold">{{ (experimentResults.metrics[metric] * 100).toFixed(2) }}%</div>
                        <div class="text-sm text-gray-600">{{ metric | titlecase }}</div>
                    </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
          </mat-stepper>
          
        <!-- Contenu Moderne et Centré -->
        <div class="modern-step-content">
          <!-- Container Principal -->
          <div class="content-container">
            <!-- Étape actuelle avec design moderne -->
            <div [ngSwitch]="getCurrentStepNumber()" class="step-wrapper">
            
            <!-- ÉTAPE 1: Dataset Overview -->
            <div *ngSwitchCase="1" class="modern-step-card">
              <div class="card-header">
                <div class="icon-container">
                  <mat-icon class="step-icon-modern">dataset</mat-icon>
                </div>
                <div class="header-text">
                  <h2 class="modern-step-title">Aperçu du Dataset</h2>
                  <p class="modern-step-description">Vérifiez les informations de votre dataset avant de continuer</p>
                </div>
              </div>
              
              <div class="step-body">
                <div *ngIf="dataset" class="dataset-card modern-card">
                  <div class="dataset-icon">
                    <mat-icon>dataset</mat-icon>
                  </div>
                  <div class="dataset-content">
                    <h3 class="dataset-name">{{ dataset.dataset_name }}</h3>
                    <p class="dataset-description">{{ dataset.objective || 'Aucune description disponible' }}</p>
                    
                    <div class="dataset-stats">
                      <div class="stat" *ngIf="dataset.instances_number">
                        <mat-icon>table_chart</mat-icon>
                        <span>{{ dataset.instances_number | number }} lignes</span>
                      </div>
                      <div class="stat" *ngIf="dataset.features_number">
                        <mat-icon>view_column</mat-icon>
                        <span>{{ dataset.features_number }} colonnes</span>
                      </div>
                      <div class="stat">
                        <mat-icon>verified</mat-icon>
                        <span>Qualité: {{ dataset.overall_score || 85 }}%</span>
                      </div>
                    </div>
                    
                    <div class="dataset-tags" *ngIf="dataset.domain">
                      <span class="tag" *ngFor="let domain of dataset.domain">{{ domain }}</span>
                    </div>
                  </div>
                </div>
                
                <div class="form-group" [formGroup]="datasetForm">
                  <label class="form-label">
                    <input type="checkbox" formControlName="confirmed" style="margin-right: 8px;">
                    Je confirme vouloir utiliser ce dataset pour mon expérience ML
                  </label>
                </div>
              </div>
            </div>

            <!-- ÉTAPE 2: Configuration -->
            <div *ngSwitchCase="2" class="step-container animate-fade-in-up">
              <div class="step-header">
                <div class="step-icon">
                  <mat-icon>tune</mat-icon>
                </div>
                <h2 class="step-title">Configuration des Données</h2>
                <p class="step-description">Définissez comment traiter vos données</p>
              </div>
              
              <div class="step-body" [formGroup]="dataQualityForm">
                <div class="form-group">
                  <label class="form-label">Colonne cible à prédire</label>
                  <p class="form-description">Sélectionnez la variable que vous souhaitez prédire</p>
                  <select class="form-input form-select" formControlName="targetColumn">
                    <option value="">Choisir une colonne...</option>
                    <option *ngFor="let col of getDatasetColumns()" [value]="col.column_name">
                      {{ col.column_name }} ({{ col.data_type_interpreted || col.data_type_original }})
                    </option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Type de tâche</label>
                  <select class="form-input form-select" formControlName="taskType">
                    <option value="classification">Classification (catégories)</option>
                    <option value="regression">Régression (valeurs numériques)</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Gestion des valeurs manquantes</label>
                  <select class="form-input form-select" formControlName="missingValueStrategy">
                    <option value="drop">Supprimer les lignes incomplètes</option>
                    <option value="mean">Remplacer par la moyenne</option>
                    <option value="median">Remplacer par la médiane</option>
                    <option value="forward_fill">Report de la valeur précédente</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Taille du jeu de test: {{ dataQualityForm.get('testSize')?.value }}%</label>
                  <input type="range" class="form-input" formControlName="testSize" min="10" max="50" step="5">
                  <p class="form-description">Pourcentage de données réservées pour tester le modèle</p>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <input type="checkbox" formControlName="featureScaling" style="margin-right: 8px;">
                    Normalisation des variables numériques
                  </label>
                </div>

                <div class="form-group">
                  <label class="form-label">Encodage des variables catégorielles</label>
                  <div class="flex gap-md">
                    <label class="form-label">
                      <input type="radio" formControlName="categoricalEncoding" value="onehot" style="margin-right: 8px;">
                      One-Hot Encoding
                    </label>
                    <label class="form-label">
                      <input type="radio" formControlName="categoricalEncoding" value="label" style="margin-right: 8px;">
                      Label Encoding
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- ÉTAPE 3: Algorithme -->
            <div *ngSwitchCase="3" class="step-container animate-fade-in-up">
              <div class="step-header">
                <div class="step-icon">
                  <mat-icon>smart_toy</mat-icon>
                </div>
                <h2 class="step-title">Sélection de l'Algorithme</h2>
                <p class="step-description">Choisissez l'algorithme de machine learning adapté à votre problème</p>
              </div>
              
              <div class="step-body">
                <div class="algorithm-grid stagger-children">
                  <div *ngFor="let algo of algorithms" 
                       class="algorithm-card"
                       [class.selected]="algorithmForm.get('algorithm')?.value === algo.name"
                       (click)="selectAlgorithm(algo.name)">
                    
                    <div class="algorithm-content">
                      <div class="algorithm-header">
                        <div class="algorithm-icon">
                          <mat-icon>{{ getAlgorithmIcon(algo.name) }}</mat-icon>
                        </div>
                        <h3 class="algorithm-name">{{ algo.display_name }}</h3>
                      </div>
                      
                      <p class="algorithm-description">{{ algo.description }}</p>
                      
                      <div class="algorithm-features">
                        <span class="feature" *ngIf="algo.supports_classification">Classification</span>
                        <span class="feature" *ngIf="algo.supports_regression">Régression</span>
                        <span class="feature" *ngIf="algo.name === 'random_forest'">Recommandé</span>
                      </div>
                    </div>
                    
                    <div class="selection-indicator">
                      <mat-icon>check</mat-icon>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ÉTAPE 4: Hyperparamètres -->
            <div *ngSwitchCase="4" class="step-container animate-fade-in-up">
              <div class="step-header">
                <div class="step-icon">
                  <mat-icon>settings</mat-icon>
                </div>
                <h2 class="step-title">Paramètres Avancés</h2>
                <p class="step-description">Affinez les paramètres de votre algorithme</p>
              </div>
              
              <div class="step-body">
                <div *ngIf="selectedAlgorithm" class="modern-card">
                  <div class="flex items-center gap-md mb-0">
                    <div class="algorithm-icon">
                      <mat-icon>{{ getAlgorithmIcon(selectedAlgorithm.name) }}</mat-icon>
                    </div>
                    <h3>{{ selectedAlgorithm.display_name }}</h3>
                  </div>
                </div>

                <div [formGroup]="hyperparametersForm">
                  <div *ngFor="let param of objectKeys(selectedAlgorithm?.hyperparameters || {})" class="form-group">
                    <ng-container [ngSwitch]="selectedAlgorithm!.hyperparameters[param].type">
                      <!-- Number Parameter -->
                      <div *ngSwitchCase="'number'">
                        <label class="form-label">{{ param | titlecase }}</label>
                        <p class="form-description">{{ selectedAlgorithm!.hyperparameters[param].description }}</p>
                        <input class="form-input" type="number" [formControlName]="param"
                               [min]="selectedAlgorithm!.hyperparameters[param].min ?? null"
                               [max]="selectedAlgorithm!.hyperparameters[param].max ?? null">
                      </div>
                      
                      <!-- Select Parameter -->
                      <div *ngSwitchCase="'select'">
                        <label class="form-label">{{ param | titlecase }}</label>
                        <p class="form-description">{{ selectedAlgorithm!.hyperparameters[param].description }}</p>
                        <select class="form-input form-select" [formControlName]="param">
                          <option *ngFor="let option of selectedAlgorithm!.hyperparameters[param].options" [value]="option">
                            {{ option }}
                          </option>
                        </select>
                      </div>
                      
                      <!-- Boolean Parameter -->
                      <div *ngSwitchCase="'boolean'">
                        <label class="form-label">
                          <input type="checkbox" [formControlName]="param" style="margin-right: 8px;">
                          {{ param | titlecase }}
                        </label>
                        <p class="form-description">{{ selectedAlgorithm!.hyperparameters[param].description }}</p>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>

            <!-- ÉTAPE 5: Entraînement -->
            <div *ngSwitchCase="5" class="step-container animate-fade-in-up">
              <div class="step-header">
                <div class="step-icon">
                  <mat-icon>{{ experimentResults ? 'check_circle' : (isTraining ? 'autorenew' : 'rocket_launch') }}</mat-icon>
                </div>
                <h2 class="step-title">
                  {{ experimentResults ? 'Entraînement Terminé !' : (isTraining ? 'Entraînement en cours...' : 'Lancer l\'Entraînement') }}
                </h2>
                <p class="step-description">
                  {{ experimentResults ? 'Votre modèle a été entraîné avec succès' : (isTraining ? 'Veuillez patienter pendant l\'entraînement' : 'Vérifiez votre configuration et lancez l\'entraînement') }}
                </p>
              </div>
              
              <div class="step-body">
                <!-- Résumé de la configuration -->
                <div *ngIf="!isTraining && !experimentResults" class="modern-card">
                  <h3>Résumé de votre configuration</h3>
                  <div class="flex gap-lg">
                    <div>
                      <strong>Dataset:</strong> {{ dataset?.dataset_name }}
                    </div>
                    <div>
                      <strong>Algorithme:</strong> {{ selectedAlgorithm?.display_name }}
                    </div>
                    <div>
                      <strong>Variable cible:</strong> {{ dataQualityForm.get('targetColumn')?.value }}
                    </div>
                    <div>
                      <strong>Type de tâche:</strong> {{ dataQualityForm.get('taskType')?.value }}
                    </div>
                  </div>
                  
                  <div class="form-group" [formGroup]="summaryForm">
                    <label class="form-label">
                      <input type="checkbox" formControlName="confirmed" style="margin-right: 8px;">
                      Je confirme vouloir lancer l'entraînement avec ces paramètres
                    </label>
                  </div>
                </div>

                <!-- Progression de l'entraînement -->
                <div *ngIf="isTraining" class="modern-card text-center">
                  <div class="training-header">
                    <div class="modern-spinner spinner-primary"></div>
                    <h3>Entraînement en cours...</h3>
                    <div class="modern-progress progress-lg">
                      <div class="progress-fill" [style.width.%]="trainingProgress"></div>
                    </div>
                    <p><strong>{{ trainingProgress }}%</strong> complété</p>
                  </div>
                  
                  <!-- Console de logs moderne -->
                  <div class="training-logs-section">
                    <div class="logs-header">
                      <h4>
                        <mat-icon>terminal</mat-icon>
                        Logs d'entraînement
                      </h4>
                      <div class="logs-controls">
                        <button class="modern-btn btn-ghost btn-sm" (click)="clearLogs()" [disabled]="trainingLogs.length === 0">
                          <mat-icon>clear_all</mat-icon>
                          Effacer
                        </button>
                        <button class="modern-btn btn-ghost btn-sm" (click)="toggleAutoScroll()">
                          <mat-icon>{{ autoScrollLogs ? 'pause' : 'play_arrow' }}</mat-icon>
                          Auto-scroll
                        </button>
                      </div>
                    </div>
                    
                    <div class="modern-console" #logsContainer>
                      <div *ngFor="let log of trainingLogs; trackBy: trackLogFn" 
                           class="console-line" 
                           [ngClass]="log.level"
                           [@fadeInUp]>
                        <span class="timestamp">{{ log.timestamp | date:'HH:mm:ss.SSS' }}</span>
                        <span class="log-level">[{{ log.level.toUpperCase() }}]</span>
                        <span class="log-message">{{ log.message }}</span>
                      </div>
                      
                      <div *ngIf="trainingLogs.length === 0" class="console-line info">
                        <span class="timestamp">{{ getCurrentTimestamp() }}</span>
                        <span class="log-level">[INFO]</span>
                        <span class="log-message">Démarrage de l'entraînement...</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Résultats -->
                <div *ngIf="experimentResults" class="modern-card elevated">
                  <div class="results-header">
                    <div class="success-icon">
                      <mat-icon>check_circle</mat-icon>
                    </div>
                    <h3>Résultats de l'entraînement</h3>
                    <p>Votre modèle a été entraîné avec succès !</p>
                  </div>
                  
                  <div class="metrics-grid">
                    <div *ngFor="let metric of objectKeys(experimentResults.metrics)" class="metric-card">
                      <div class="metric-icon">
                        <mat-icon>{{ getMetricIcon(metric) }}</mat-icon>
                      </div>
                      <div class="metric-content">
                        <div class="metric-value">{{ (experimentResults.metrics[metric] * 100).toFixed(2) }}%</div>
                        <div class="metric-label">{{ getMetricLabel(metric) }}</div>
                        
                        <!-- Barre de progression pour chaque métrique -->
                        <div class="metric-progress">
                          <div class="modern-progress progress-sm" 
                               [ngClass]="getMetricProgressClass(metric)">
                            <div class="progress-fill" 
                                 [style.width.%]="experimentResults.metrics[metric] * 100"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="results-actions">
                    <button class="modern-btn btn-secondary" (click)="downloadModel()">
                      <mat-icon>download</mat-icon>
                      Télécharger le modèle
                    </button>
                    <button class="modern-btn btn-ghost" (click)="viewDetailedResults()">
                      <mat-icon>analytics</mat-icon>
                      Voir les détails
                    </button>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

              <!-- Navigation Moderne Flottante -->
        <nav class="modern-navigation">
          <div class="navigation-container">
            <div class="nav-left">
              <button class="modern-nav-button secondary" 
                (click)="previousStep()" 
                      [disabled]="getCurrentStepNumber() === 1">
                <mat-icon>chevron_left</mat-icon>
                <span>Précédent</span>
              </button>
            </div>

            <div class="nav-center">
              <div class="step-dots-modern">
                <div *ngFor="let step of [1,2,3,4,5]; let i = index" 
                     class="dot-modern"
                     [class.active]="getCurrentStepNumber() === step"
                     [class.completed]="getCurrentStepNumber() > step">
                  <span class="dot-number">{{ step }}</span>
                </div>
              </div>
            </div>

            <div class="nav-right">
              <button *ngIf="getCurrentStepNumber() < 5" 
                      class="modern-nav-button primary" 
                (click)="nextStep()"
                      [disabled]="!isCurrentStepValid()">
                <span>Suivant</span>
                <mat-icon>chevron_right</mat-icon>
              </button>
              
              <button *ngIf="getCurrentStepNumber() === 5 && !isTraining && !experimentResults" 
                      class="modern-nav-button launch" 
                (click)="startTraining()"
                      [disabled]="!isFormValid()">
                <mat-icon>rocket_launch</mat-icon>
                <span>Lancer l'entraînement</span>
              </button>
              
              <button *ngIf="experimentResults" 
                      class="modern-nav-button success" 
                      (click)="backToApp()">
                <mat-icon>check_circle</mat-icon>
                <span>Terminer</span>
              </button>
            </div>
          </div>
        </nav>
      </div>
    </main>
  </div>
</div> 