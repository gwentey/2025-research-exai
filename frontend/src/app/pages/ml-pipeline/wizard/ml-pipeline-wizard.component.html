<div class="blank-layout-container">
  <div class="auth-wrapper">
    <div class="ml-wizard-card">
      <div class="auth-body">
        <!-- Hero Section - Style Dashboard -->
        <div class="wizard-hero" [@fadeInUp]>
          <div class="hero-background">
            <div class="particle" *ngFor="let i of [1,2,3,4,5,6,7,8]"></div>
          </div>
          
          <div class="hero-content">
            <div class="hero-icon">
              <div class="icon-glow"></div>
              <mat-icon class="wizard-main-icon">auto_awesome</mat-icon>
            </div>
            
            <h1 class="wizard-title">{{ 'ML_PIPELINE.WIZARD.TITLE' | translate }}</h1>
            <p class="wizard-subtitle">{{ 'ML_PIPELINE.WIZARD.SUBTITLE' | translate }}</p>
          </div>
        </div>

        <!-- Contenu Principal -->
        <div class="wizard-content">
          <!-- Progress Bar Moderne -->
          <div class="progress-container">
            <mat-progress-bar 
              mode="determinate" 
              [value]="getProgressPercentage()"
              class="wizard-progress">
            </mat-progress-bar>
            <div class="progress-text">
              {{ 'ML_PIPELINE.WIZARD.STEP_PROGRESS' | translate: { current: getCurrentStepNumber(), total: 5 } }}
            </div>
          </div>

          <!-- Stepper Moderne -->
            <mat-stepper #stepper linear class="wizard-stepper" [@fadeInUp]>
            <!-- Step 1: Dataset Overview -->
            <mat-step [stepControl]="datasetForm">
              <form [formGroup]="datasetForm">
                <ng-template matStepLabel>{{ 'ML_PIPELINE.STEPS.DATASET_OVERVIEW' | translate }}</ng-template>
                
                <div class="step-container">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>dataset</mat-icon>
                    </div>
                    <h2 class="step-title">{{ 'ML_PIPELINE.DATASET.TITLE' | translate }}</h2>
                  </div>
                  
                  <div *ngIf="dataset" class="step-form">
                    <div class="dataset-info-card">
                      <div class="preview-icon">
                        <mat-icon>dataset</mat-icon>
                      </div>
                      
                      <div class="dataset-details">
                        <div class="dataset-header">
                          <h3>{{ dataset.dataset_name }}</h3>
                          <div class="dataset-badges">
                            <span class="badge" *ngFor="let domain of dataset.domain">{{ domain }}</span>
                          </div>
                        </div>
                        
                        <p class="dataset-description">{{ dataset.objective || 'Aucune description disponible' }}</p>
                        
                        <div class="dataset-stats">
                          <div class="stat" *ngIf="dataset.instances_number">
                            <mat-icon>table_chart</mat-icon>
                            <span>{{ dataset.instances_number | number }} lignes</span>
                          </div>
                          <div class="stat" *ngIf="dataset.features_number">
                            <mat-icon>view_column</mat-icon>
                            <span>{{ dataset.features_number }} colonnes</span>
                          </div>
                          <div class="stat">
                            <mat-icon>verified</mat-icon>
                            <span>Qualité: {{ dataset.overall_score || 85 }}%</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <mat-checkbox formControlName="confirmed" class="step-checkbox">
                      Confirmer la sélection de ce dataset
                    </mat-checkbox>
                  </div>
                </div>
                
              </form>
            </mat-step>
            
            <!-- Step 2: Configuration des Données -->
            <mat-step [stepControl]="dataQualityForm">
              <form [formGroup]="dataQualityForm">
                <ng-template matStepLabel>Configuration</ng-template>
                
                <div class="step-container">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>tune</mat-icon>
                    </div>
                    <h2 class="step-title">Configuration des données</h2>
                  </div>
                  
                  <div class="step-form">
                    <mat-form-field appearance="outline">
                      <mat-label>Colonne cible à prédire</mat-label>
                      <mat-select formControlName="targetColumn">
                        <mat-option *ngFor="let col of getDatasetColumns()" [value]="col.column_name">
                          {{ col.column_name }} <span class="text-muted">({{ col.data_type_interpreted || col.data_type_original }})</span>
                        </mat-option>
                      </mat-select>
                      <mat-hint>Sélectionnez la variable que vous souhaitez prédire</mat-hint>
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline">
                      <mat-label>Type de tâche</mat-label>
                      <mat-select formControlName="taskType">
                        <mat-option value="classification">
                          <mat-icon>category</mat-icon>
                          Classification (catégories)
                        </mat-option>
                        <mat-option value="regression">
                          <mat-icon>trending_up</mat-icon>
                          Régression (valeurs numériques)
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    
                    <mat-form-field appearance="outline">
                      <mat-label>Gestion des valeurs manquantes</mat-label>
                      <mat-select formControlName="missingValueStrategy">
                        <mat-option value="drop">Supprimer les lignes incomplètes</mat-option>
                        <mat-option value="mean">Remplacer par la moyenne</mat-option>
                        <mat-option value="median">Remplacer par la médiane</mat-option>
                        <mat-option value="forward_fill">Report de la valeur précédente</mat-option>
                      </mat-select>
                    </mat-form-field>
                    
                    <div class="slider-group">
                      <mat-label>Taille du jeu de test: {{ dataQualityForm.get('testSize')?.value }}%</mat-label>
                      <mat-slider min="10" max="50" step="5" thumbLabel [displayWith]="displayWithPercent">
                        <input matSliderThumb formControlName="testSize">
                      </mat-slider>
                      <mat-hint>Pourcentage de données réservées pour tester le modèle</mat-hint>
                    </div>
                    
                    <div class="options-group">
                      <mat-slide-toggle formControlName="featureScaling">
                        Normalisation des variables numériques
                      </mat-slide-toggle>
                      
                      <mat-radio-group formControlName="categoricalEncoding" class="encoding-group">
                        <mat-label class="group-label">Encodage des variables catégorielles:</mat-label>
                        <mat-radio-button value="onehot">One-Hot Encoding</mat-radio-button>
                        <mat-radio-button value="label">Label Encoding</mat-radio-button>
                      </mat-radio-group>
                    </div>
                  </div>
                </div>
                
              </form>
            </mat-step>
            
            <!-- Step 3: Sélection de l'Algorithme -->
            <mat-step [stepControl]="algorithmForm">
              <form [formGroup]="algorithmForm">
                <ng-template matStepLabel>Algorithme</ng-template>
                
                <div class="step-container">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>smart_toy</mat-icon>
                    </div>
                    <h2 class="step-title">Choisir un algorithme</h2>
                  </div>
                  
                  <div class="step-form">
                    <div class="algorithm-selection">
                      <div *ngFor="let algo of algorithms" 
                           class="algorithm-option" 
                           [class.selected]="algorithmForm.get('algorithm')?.value === algo.name"
                           (click)="algorithmForm.patchValue({algorithm: algo.name}); onAlgorithmSelected()">
                        
                        <div class="algo-header">
                          <div class="algo-icon">
                            <mat-icon>{{ algo.name === 'decision_tree' ? 'account_tree' : 'park' }}</mat-icon>
                          </div>
                          <mat-icon class="selection-icon" 
                                   [class.selected]="algorithmForm.get('algorithm')?.value === algo.name">
                            {{ algorithmForm.get('algorithm')?.value === algo.name ? 'radio_button_checked' : 'radio_button_unchecked' }}
                          </mat-icon>
                        </div>
                        
                        <h3 class="algo-name">{{ algo.display_name }}</h3>
                        
                        <p class="algo-description">{{ algo.description }}</p>
                        
                        <div class="algo-tags">
                          <span class="tag" *ngIf="algo.supports_classification">Classification</span>
                          <span class="tag" *ngIf="algo.supports_regression">Régression</span>
                          <span class="tag" *ngIf="algo.name === 'random_forest'">Recommandé</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
            
            <!-- Step 4: Réglages Avancés -->
            <mat-step [stepControl]="hyperparametersForm">
              <form [formGroup]="hyperparametersForm">
                <ng-template matStepLabel>Réglages</ng-template>
                
                <div class="step-container">
                  <div class="step-header">
                    <div class="step-icon">
                      <mat-icon>settings</mat-icon>
                    </div>
                    <h2 class="step-title">Paramètres avancés</h2>
                  </div>
                  
                  <div class="step-form" *ngIf="selectedAlgorithm">
                    <div class="selected-algorithm">
                      <mat-icon>{{ selectedAlgorithm.name === 'decision_tree' ? 'account_tree' : 'park' }}</mat-icon>
                      <span>{{ selectedAlgorithm.display_name }}</span>
                    </div>
                    
                    <div *ngFor="let param of objectKeys(selectedAlgorithm.hyperparameters)" class="param-field">
                      <ng-container [ngSwitch]="selectedAlgorithm.hyperparameters[param].type">
                        <!-- Number Parameter -->
                        <mat-form-field *ngSwitchCase="'number'" appearance="outline">
                          <mat-label>{{ param | titlecase }}</mat-label>
                          <input matInput type="number" [formControlName]="param"
                                 [min]="selectedAlgorithm.hyperparameters[param].min ?? null"
                                 [max]="selectedAlgorithm.hyperparameters[param].max ?? null">
                          <mat-hint>{{ selectedAlgorithm.hyperparameters[param].description }}</mat-hint>
                        </mat-form-field>
                        
                        <!-- Select Parameter -->
                        <mat-form-field *ngSwitchCase="'select'" appearance="outline">
                          <mat-label>{{ param | titlecase }}</mat-label>
                          <mat-select [formControlName]="param">
                            <mat-option *ngFor="let option of selectedAlgorithm.hyperparameters[param].options" [value]="option">
                              {{ option }}
                            </mat-option>
                          </mat-select>
                          <mat-hint>{{ selectedAlgorithm.hyperparameters[param].description }}</mat-hint>
                        </mat-form-field>
                        
                        <!-- Boolean Parameter -->
                        <div *ngSwitchCase="'boolean'" class="boolean-param">
                          <mat-slide-toggle [formControlName]="param">
                            {{ param | titlecase }}
                          </mat-slide-toggle>
                          <p class="param-description">{{ selectedAlgorithm.hyperparameters[param].description }}</p>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
            
            <!-- Step 5: Lancement -->
            <mat-step [stepControl]="summaryForm">
              <form [formGroup]="summaryForm">
                <ng-template matStepLabel>Lancement</ng-template>
                
                <div class="step-container">
                  <div class="step-header" *ngIf="!isTraining && !experimentResults">
                    <div class="step-icon">
                      <mat-icon>rocket_launch</mat-icon>
                    </div>
                    <h2 class="step-title">Prêt à lancer l'entraînement</h2>
                  </div>
                  
                  <!-- Résumé Configuration -->
                  <div class="step-form" *ngIf="!isTraining && !experimentResults">
                    <div class="summary-info">
                      <div class="summary-item">
                        <strong>Dataset:</strong> {{ dataset?.dataset_name }}
                      </div>
                      <div class="summary-item">
                        <strong>Algorithme:</strong> {{ selectedAlgorithm?.display_name }}
                      </div>
                      <div class="summary-item">
                        <strong>Variable cible:</strong> {{ dataQualityForm.get('targetColumn')?.value }}
                      </div>
                      <div class="summary-item">
                        <strong>Type de tâche:</strong> {{ dataQualityForm.get('taskType')?.value }}
                      </div>
                    </div>
                    
                    <mat-checkbox formControlName="confirmed" class="step-checkbox">
                      Je confirme vouloir lancer l'entraînement avec ces paramètres
                    </mat-checkbox>
                  </div>
                  
                  <!-- Progression Training -->
                  <div class="training-progress" *ngIf="isTraining">
                    <div class="step-header">
                      <div class="step-icon">
                        <mat-icon>autorenew</mat-icon>
                      </div>
                      <h2 class="step-title">Entraînement en cours...</h2>
                    </div>
                    <mat-progress-bar mode="determinate" [value]="trainingProgress"></mat-progress-bar>
                    <p>{{ trainingProgress }}% terminé</p>
                  </div>
                  
                  <!-- Résultats -->
                  <div class="results-display" *ngIf="experimentResults">
                    <div class="step-header">
                      <div class="step-icon">
                        <mat-icon>check_circle</mat-icon>
                      </div>
                      <h2 class="step-title">Entraînement terminé !</h2>
                    </div>
                    
                    <div class="metrics-grid">
                      <div *ngFor="let metric of objectKeys(experimentResults.metrics)" class="metric-card">
                        <strong>{{ metric | titlecase }}</strong>
                        <span>{{ (experimentResults.metrics[metric] * 100).toFixed(2) }}%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </mat-step>
          </mat-stepper>
          
          <!-- Navigation Moderne -->
          <div class="navigation-buttons">
            <div class="d-flex justify-content-between align-items-center">
              <button 
                mat-stroked-button 
                (click)="previousStep()" 
                [disabled]="getCurrentStepNumber() === 1"
                class="step-button secondary">
                <mat-icon>chevron_left</mat-icon>
                Précédent
              </button>

              <div class="step-indicators">
                <div class="step-dot" 
                     *ngFor="let step of [1,2,3,4,5]; let i = index"
                     [class.active]="getCurrentStepNumber() === step"
                     [class.completed]="getCurrentStepNumber() > step">
                </div>
              </div>

              <button 
                mat-raised-button 
                color="primary" 
                (click)="nextStep()"
                *ngIf="getCurrentStepNumber() < 5"
                [disabled]="!isCurrentStepValid()"
                class="step-button primary">
                Suivant
                <mat-icon>chevron_right</mat-icon>
              </button>
              
              <button 
                mat-raised-button 
                color="accent" 
                (click)="startTraining()"
                *ngIf="getCurrentStepNumber() === 5 && !isTraining && !experimentResults"
                [disabled]="!isFormValid()"
                class="step-button launch">
                <mat-icon>rocket_launch</mat-icon>
                Lancer l'entraînement
              </button>
              
              <button 
                mat-raised-button 
                color="primary" 
                (click)="backToApp()"
                *ngIf="experimentResults"
                class="step-button success">
                <mat-icon>check_circle</mat-icon>
                Terminer
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 